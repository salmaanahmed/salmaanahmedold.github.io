define("popups/constants/closeButtonsConstants",[],function(){"use strict";return{ICON:"icon",ICON_TYPE:"wysiwyg.viewer.components.PopupCloseIconButton",TEXT:"text",TEXT_TYPE:"wysiwyg.viewer.components.PopupCloseTextButton"}}),define("popups/presets/closeButtonsPresets",["lodash","popups/constants/closeButtonsConstants"],function(n,p){"use strict";var e={};return e[p.ICON_TYPE]=function(e){var t=e.addPanel.getSectionsByComponentType(p.ICON_TYPE,null),o=n.get(t,"0.props.items.0.structure");return o.layout=n.omit(o.layout,["x","y"]),o},e[p.TEXT_TYPE]=function(e){var t,o=e.addPanelInfra.componentsDefaultData.getComponentDefault(p.TEXT_TYPE),s=n.head((t=e).addPanelInfra.addPanelStyleManager.getComponentThemeStyles(p.TEXT_TYPE,t.theme,t.components));return o.layout=o.panelLayout,o.style=s,delete o.panelLayout,o},e}),define("popups/actions/closeButtonsActions",["lodash","util","popups/constants/closeButtonsConstants","popups/presets/closeButtonsPresets"],function(d,g,t,c){"use strict";function o(e,t,o){var s=e.pages.popupPages.getCurrentPopup(),n=e.pages.popupPages.getPopupContainer(),p=e.components.layout.get(n);p.width=Math.min(980,p.width);var a,r,i,u=(a=c[t](e),r=p,i=o,d.defaults({layout:g.layoutUtils.convertAnyPositionToLeftTopPosition(d.assign({},a.layout,i),r)},a));e.components.add(n,u),e.history.add("added close "+t+" button to popup "+s.id)}function s(t,e){var o=t.pages.popupPages.getCurrentPopup(),s=t.components.get.byType(e,o);d.isEmpty(s)||t.components.remove(s).then(function(e){e&&t.history.add("removed close buttons from popup "+o.id)})}return{addIconButton:function(e){o(e,t.ICON_TYPE,{y:20,right:20})},addTextButton:function(e){o(e,t.TEXT_TYPE,{center:0,bottom:20})},removeIconButton:function(e){s(e,t.ICON_TYPE)},removeTextButton:function(e){s(e,t.TEXT_TYPE)}}}),define("popups/constants/openBehaviorsConstants",[],function(){"use strict";return{DESKTOP:1,MOBILE:2,DESKTOP_AND_MOBILE:3,FLAG_DESKTOP:"openInDesktop",FLAG_MOBILE:"openInMobile",OPEN_DELAY_DEFAULT_VALUE:2,SITE_BEHAVIOR_TYPE:"site",LOAD_ACTION:"load",OPEN_POPUP_BEHAVIOR:"openPopup"}}),define("popups/queries/openBehaviorsQueries",["lodash","popups/constants/openBehaviorsConstants"],function(n,o){"use strict";function s(e,t){return n.isEmpty(e)?t.behaviors.getDefinition(o.OPEN_POPUP_BEHAVIOR):e[0]}function p(e,t){var o=e.dsRead.siteSegments.getSiteStructureId();return n.find(t,{pageId:o})}function a(e,t,o){var s=p(e,t);return s?n.map(o,function(e){return n.defaults({pageId:e},s)}):t}return{isOpenInMobile:function(e,t){return s(e,t).params[o.FLAG_MOBILE]},isMasterPageSelected:function(e,t){return!!p(e,t)},findMasterPageBehavior:p,getCurrentOpenBehaviors:function(e){var t=e.dsRead.pages.popupPages.getCurrentPopupId();return e.pages.popupPages.getOpenBehaviorsForPopupWithId(t)},getSomeBehavior:s,getDelay:function(e,t){return s(e,t).params.delay},getDenormalizedBehaviors:a,getDisabledPageIds:function(e,t,o){var s=a(o,e,o.dsRead.pages.getPageIdList());return n(s).reject({popupId:t}).map("pageId").value()}}}),define("popups/mappers/getInfoForActions",["lodash","popups/queries/openBehaviorsQueries"],function(a,r){"use strict";return function(e){var t=e.pages.popupPages.getCurrentPopup(),o=e.pages.popupPages.getOpenBehaviorsForPopups(),s=a.filter(o,{popupId:t.id}),n=r.getDisabledPageIds(o,t.id,e),p=e.dsRead.pages.getPageIdList();return{allPageIds:p,behaviorDefaults:r.getSomeBehavior(s,e).params,disabledPageIds:a.zipObject(n),enabledPageIds:a.difference(p,n),openBehaviors:s,popupPointer:t,selectedPageIds:a.map(s,"pageId")}}}),define("popups/actions/openBehaviorsActions",["coreBi","lodash","popups/mappers/getInfoForActions","popups/queries/openBehaviorsQueries","popups/constants/openBehaviorsConstants"],function(o,d,g,c,i){"use strict";function a(e){return d(e.enabledPageIds).union(e.selectedPageIds).size()}function n(e,t,o){var s=a(t);r(e,{all_pages_selected:o,num_selected_pages:o?s:0,num_unselected_pages:o?0:s})}function l(e,t,o,s){var n=a(t),p=o?d(t.selectedPageIds).push(s).size():d(t.selectedPageIds).pull(s).size();r(e,{all_pages_selected:n===p,num_selected_pages:p,num_unselected_pages:n-p})}function r(e,t){e.bi.event(o.events.popups.POP_UP_SETTINGS_PAGE_SELECTOR_OK,t)}function P(e,t,o,s){var n=e.components.get.byId(t),p=e.components.get.byId(o),a=e.actions.getDefinition(i.LOAD_ACTION),r=e.behaviors.getDefinition(i.OPEN_POPUP_BEHAVIOR);r.params=s,e.behaviors.update(n,a,p,r)}function f(e,t,o){var s=e.components.get.byId(t),n=e.components.get.byId(o),p=e.actions.getDefinition(i.LOAD_ACTION),a=e.behaviors.getDefinition(i.OPEN_POPUP_BEHAVIOR);e.behaviors.remove(s,p,n,a)}function u(t,e){d.forEach(e,function(e){f(t,e.pageId,e.popupId)})}return{assignOpenBehaviorOnlyToCurrentPage:function(e){var t=g(e),o=e.dsRead.pages.getPrimaryPageId();l(e,t,!0,o),d.has(t.disabledPageIds,o)||(u(e,t.openBehaviors),P(e,o,t.popupPointer.id,t.behaviorDefaults),e.history.add("assign open behavior only to current page"))},removeOpenBehaviorFromAllPages:function(e){var t=g(e);u(e,t.openBehaviors),n(e,t,!1),e.history.add("remove open behavior from all pages")},assignOpenBehaviorToAllPages:function(t){var o=g(t),s=o.popupPointer.id,e=o.openBehaviors;c.isMasterPageSelected(t,e)||(d.isEmpty(o.disabledPageIds)?(u(t,e),P(t,t.dsRead.siteSegments.getSiteStructureId(),s,o.behaviorDefaults)):d(o.enabledPageIds).difference(o.selectedPageIds).forEach(function(e){P(t,e,s,o.behaviorDefaults)}),n(t,o,!0),t.history.add("assign open behavior to all pages"))},assignOpenBehaviorToPage:function(e,t){var o=g(e),s=o.popupPointer.id,n=o.openBehaviors;if(!c.isMasterPageSelected(e,n)&&!d.has(o.disabledPageIds,t)){var p=o.selectedPageIds.concat(t);1<p.length&&p.length===o.allPageIds.length?(u(e,n),P(e,e.dsRead.siteSegments.getSiteStructureId(),s,o.behaviorDefaults)):P(e,t,s,o.behaviorDefaults),l(e,o,!0,t),e.history.add("assign open behavior to page")}},removeOpenBehaviorFromPage:function(e,t){var o,s,n,p,a=e.dsRead.pages.popupPages.getCurrentPopupId(),r=e.pages.popupPages.getOpenBehaviorsForPopupWithId(a),i=c.findMasterPageBehavior(e,r),u=g(e);i?(o=e,s=i,n=t,p=d.without(o.dsRead.pages.getPageIdList(),n),f(o,o.dsRead.siteSegments.getSiteStructureId(),s.popupId),p.forEach(function(e){P(o,e,s.popupId,s.params)})):f(e,t,a),l(e,u,!1,t),e.history.add("remove open behavior from page")},changeOpenDelay:function(t,o){var e=t.dsRead.pages.popupPages.getCurrentPopupId();t.pages.popupPages.getOpenBehaviorsForPopupWithId(e).forEach(function(e){P(t,e.pageId,e.popupId,d.defaults({delay:o},e.params))})},toggleLoadOnMobile:function(t,o){var e=t.dsRead.pages.popupPages.getCurrentPopupId();t.pages.popupPages.getOpenBehaviorsForPopupWithId(e).forEach(function(e){P(t,e.pageId,e.popupId,d.defaults({openInMobile:o},e.params))}),t.history.add("toggle load on mobile")}}}),define("popups/queries/closeButtonsQueries",["lodash","popups/constants/closeButtonsConstants"],function(n,e){"use strict";var s=e;function p(e,t,o){var s=o.components.get.byType(e,t);return!n.isEmpty(s)}return{getCloseButtonsInfo:function(e,t){var o={};return o[s.ICON]=p(s.ICON_TYPE,e,t),o[s.TEXT]=p(s.TEXT_TYPE,e,t),{has:o}}}}),define("popups/mappers/getDesktopPanelProps",["lodash","popups/queries/closeButtonsQueries","popups/queries/openBehaviorsQueries"],function(p,a,r){"use strict";return function(e){var t=e.pages.popupPages.getCurrentPopup(),o=e.pages.popupPages.getOpenBehaviorsForPopups(),s=p.filter(o,{popupId:t.id}),n=a.getCloseButtonsInfo(t,e);return{delay:r.getDelay(s,e),hasIconButton:n.has.icon,hasTextButton:n.has.text,isMasterPageSelected:r.isMasterPageSelected(e,s),selectedPageIds:p.map(s,"pageId")}}}),define("popups/mappers/getMobilePanelProps",["popups/queries/openBehaviorsQueries"],function(o){"use strict";return function(e){var t=o.getCurrentOpenBehaviors(e);return{shouldOpenInMobile:o.isOpenInMobile(t,e)}}}),define("popups/mappers/getPageSelectorPanelProps",["lodash","popups/queries/openBehaviorsQueries"],function(c,l){"use strict";var P=c.curry(function(e,t){var o=t[0].popupId;return e.pages.getPageTitle(o)});return function(e){var t,o,s,n=e.pages.popupPages.getCurrentPopup(),p=e.dsRead.pages.getPageIdList(),a=l.getDenormalizedBehaviors(e,e.pages.popupPages.getOpenBehaviorsForPopups(),p),r=c.filter(a,{popupId:n.id}),i=c.reject(a,{popupId:n.id}),u=c(i).groupBy("pageId").mapValues(P(e)).value(),d=c.difference(p,c.keys(u)),g=c.map(r,"pageId");return{selectAll:{visible:1<p.length,disabled:0===d.length,indeterminate:(t=0,o=r.length,s=d.length,t<o&&o<s),checked:0<g.length&&g.length===d.length},selectedPageIds:g,occupiedPages:u}}}),define("popups",["popups/actions/closeButtonsActions","popups/actions/openBehaviorsActions","popups/mappers/getDesktopPanelProps","popups/mappers/getMobilePanelProps","popups/mappers/getPageSelectorPanelProps"],function(e,t,o,s,n){"use strict";return{actions:{closeButtons:e,openBehaviors:t},mappers:{desktopPanel:o,mobilePanel:s,pagesSelectorPanel:n}}});
//# sourceMappingURL=popups.min.js.map