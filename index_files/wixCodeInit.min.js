define("wixCodeInit",["lodash","coreUtils","experiment","platformInit","host-platform-api"],function(e,r,t,n,o){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=1371)}({0:function(r,t){r.exports=e},1:function(e,t){e.exports=r},1371:function(e,r,t){var n,o;n=[t(1372),t(1375),t(33)],void 0===(o=function(e,r,t){"use strict";return{getAppApi:e.getApi,initMainR:r,appsUtils:t.appsUtils,specMapUtils:t.specMapUtils,registerDeps:t.registerDeps}}.apply(r,n))||(e.exports=o)},1372:function(e,r,t){var n,o;n=[t(0),t(33),t(1),t(1373),t(1374),t(51)],void 0===(o=function(e,r,t,n,o,i){"use strict";var a=t.urlUtils,s=a.parseUrl,d=a.isQueryParamOn;var p=function(r){var t=[];return e(r).filter("controllerScriptMap").forEach(function(r){e.forEach(r.controllerScriptMap,function(e,n){t.push({id:n,url:e,appDefinitionId:r.id,isControllerScript:!0})})}),t};function c(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments[2],i=!!r.publicModel,a="undefined"!=typeof window&&!window.clientSideRender,c="undefined"==typeof window||window.isPseudoWindow,l=r.wixBiSession,f=l.viewerSessionId,m=l.visitorId,g=l.initialTimestamp,w=l.initialRequestTimestamp,v=l.siteMemberId,S=l.random,M=l.coin,y=l.pn,x=l.requestId,b=r.rendererModel,h=b.metaSiteId,I=b.userId,C=s(n.currentUrl);n.applications=n.applications||[];var A,P=p(n.applications),U=n.applications.concat(P),k={biSessionData:{metaSiteId:h,viewerSessionId:f,visitorId:m,siteMemberId:v,requestId:x,ownerId:I,pageLoadStart:g,networkPageLoadStart:w,pageNumber:y,random:S,coin:M,muteBi:d(C,"isqa")||d(C,"suppressbi"),sampleRatioState:e.get(C,"query.sampleratio")},deviceType:n.isMobileView?"mobile":"desktop",renderCycle:a&&!c?2:1,renderingEnv:c?"backend":"browser",userWarmup:r.userWarmup,locale:r.rendererModel.locale,namespacesSdkSource:n.namespacesSdkSource,externalComponentsSource:n.externalComponentsSource,wixCodeNamespacesAndElementorySupportSource:n.wixCodeNamespacesAndElementorySupportSource,wixCodeViewerAppSource:n.wixCodeViewerAppSource,openExperiments:(A=r.rendererModel.runningExperiments,e.reduce(A,function(e,r,t){return"new"===r&&e.push(t),e},[])),applications:JSON.stringify(U),csrfToken:t.cookieUtils.getCookie("XSRF-TOKEN"),isDebug:n.isDebug};return k=u(r)?e.merge(k,{compId:"wixCode_"+o.appDefinitionId,viewMode:i?"site":"preview"}):e.merge(k,{viewMode:i?"site":r.renderFlags.componentViewMode||"preview"})}function u(r){var t=r.rendererModel.clientSpecMap.toJS?r.rendererModel.clientSpecMap.toJS():r.rendererModel.clientSpecMap;return!!r.rendererModel.wixCodeModel&&e.some(t,{type:"siteextension"})}return{getApi:function(){var e=[],a=[],s=r.messageProxy.get(),d=!1,p=!0,l=null,f=null,m=null,g=void 0,w=void 0;return{init:function(a,p){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!d){l.applications=l.applications||[];var f=l.applications.length>0;if(u(a)){var m=r.specMapUtils.getAppSpec(p),v=n.buildUrl(a,m,l);g=o.getIFrameForApp(v,m),w=c(a,l,m)}else{if(!f)return;var S=n.buildStaticUrl(a,l);g=o.getIFrameForApp(S,{}),w=c(a,l)}var M=function(r,t){var n;o.isIFrameEvent(r,t)&&("PLATFORM_IFRAME"!==(n=t.data).intent&&"WIX_CODE"!==n.intent||"wix_code_iframe_initialized"!==n.type||r.contentWindow.postMessage(i.messageBuilder.setBootstrapParametersMessage(w),"*"),function(e){return("PLATFORM_IFRAME"===e.intent||"WIX_CODE"===e.intent)&&"wix_code_iframe_loaded"===e.type}(t.data)&&s.setMessageHandler(function(e){r.contentWindow.postMessage(e,"*")}),e.forEach(function(e){e(t.data)}))}.bind(null,g);window.addEventListener("message",M,!1),function(e){function r(){var r=window.document.body;r.insertBefore(e,r.firstChild),t.loggingUtils.performance.mark("platform-iframe-added-to-dom")}"loading"!==window.document.readyState?r():window.document.addEventListener("DOMContentLoaded",function(){r()})}(g),d=!0}},destroyAppsContainer:function(){g&&(g.parentNode.removeChild(g),d=!1,s=r.messageProxy.get(),g=void 0)},sendMessage:function(e){e&&s.sendOrHoldMessage(function(e){return a.reduce(function(e,r){return r(e)},e)}(e))},registerMessageHandler:function(r){e.push(r)},registerMessageModifier:function(e){a.push(e)},unregisterMessageHandler:function(r){var t=e.indexOf(r);-1!==t&&e.splice(t,1)},preLoadWidgets:function(e,t){!l&&u(e)&&r.widgetsPreLoader.asyncGetPreLoadMessage(e,t,function(e){p&&!l&&(l=e,s.sendOrHoldMessage(l))})},preLoadUserCode:function(e,t){(!f&&u(e)||r.appsUtils.getAppsBaseInfo({clientSpecMap:e.rendererModel.clientSpecMap,serviceTopology:e.serviceTopology,rendererModel:e.rendererModel}))&&r.widgetsPreLoader.asyncGetPreLoadUserCodeMessage(e,t,function(e){f||(f=e,s.sendOrHoldMessage(f))})},preInitWidgets:function(e,t){!m&&u(e)&&r.widgetsPreLoader.asyncGetPreInitMessage(e,t,function(e){m||(m=e,s.sendOrHoldMessage(m))})},isAppInitiated:function(){return d},getAppsIframe:function(){return g}}}}}.apply(r,n))||(e.exports=o)},1373:function(e,r,t){var n,o;n=[t(1)],void 0===(o=function(e){"use strict";function r(){for(var e=arguments[0],r=1;r<arguments.length;++r)e=e.replace(/\/$/,"")+"/"+arguments[r].replace(/^\//,"");return e}function t(e,r){var t,n=e.serviceTopology,o=(t=e.santaBase,/^https?:\/\/localhost(:[0-9]+)?\/?$/.test(t)||function(e){return/^https?:\/\/s3.amazonaws.com\/integration-tests-statics\/(.+)\/SNAPSHOT\/santa?$/.test(e)}(e.santaBase)?n.scriptsLocationMap.santa:e.santaBase);return o=function(e,r){var t=e.lastIndexOf("/");return/^\d+\.\d+\.\d+$/.test(r)?e.substring(0,t+1)+r:e}(o,r),/(.*\/services\/)?(.*)/.exec(o)[2]}function n(){return e.wSpy.wSpyParam?"?wspy="+e.wSpy.wSpyParam:""}function o(){if("function"!=typeof URLSearchParams&&"undefined"!=typeof window)return!1;var e=void 0;try{e=window.parent.location.search}catch(r){e=""}return(new URLSearchParams(e).get("debug")||"").includes("localWorker")}return{buildUrl:function(e,i){return function(e,n,i,a){if(o())return"//localhost/node_modules/viewer-platform-worker/"+(i.useWixCodeFallback?"fallback.html":"index.html");var s=a?"pub":"dev",d="//"+n.instanceId+"."+s+".",p=e.serviceTopology.wixCloudBaseDomain,c="node_modules/viewer-platform-worker/"+(i.useWixCodeFallback?"fallback.html":"index.html");return d+r(p,"_partials",t(e,i.runtimeSource),c)}(e,i,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},!!e.publicModel)+n()},buildStaticUrl:function(e){return function(e,n){if(o())return"//localhost/node_modules/viewer-platform-worker/"+(n.useWixCodeFallback?"fallback.html":"index.html");var i=t(e,n.runtimeSource),a="node_modules/viewer-platform-worker/"+(n.useWixCodeFallback?"fallback.html":"index.html");return r(e.publicModel?"/":"//editor."+e.serviceTopology.serverName+"/","_partials",i,a)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})+n()}}}.apply(r,n))||(e.exports=o)},1374:function(e,r,t){var n,o;n=[t(0)],void 0===(o=function(e){"use strict";return{getIFrameForApp:function(r,t){var n=window.document.createElement("iframe");return n.style.cssText="position: fixed; left: 0; right: 0; top: 0; bottom: 0; width: 1px; height: 1px; background: transparent; border: 0",n.tabIndex=-1,n.setAttribute("aria-hidden","true"),n.src=r,e.get(t,"applicationId")&&e.get(t,"appDefinitionId")&&(n.setAttribute("data-app-id",t.applicationId),n.setAttribute("data-app-definition-id",t.appDefinitionId)),n},isIFrameEvent:function(e,r){return r.source===e.contentWindow}}}.apply(r,n))||(e.exports=o)},1375:function(e,r,t){var n,o;n=[t(0),t(33),t(8)],void 0===(o=function(e,r,t){"use strict";return function(n){var o=n.appApi,i=n.siteModel,a=n.isMobileView,s=n.queryUtil,d=n.currentUrl,p=n.isBot,c=!e.isEmpty(s.getParameterByName("debug"));d=d||window.document.location.href;var u,l=r.wixCodeUrlUtils.buildScriptsSources(i.serviceTopology,{isDebug:c}),f=l.namespacesSdkSource,m=l.externalComponentsSource,g=l.wixCodeNamespacesAndElementorySupportSource,w=l.wixCodeViewerAppSource,v=(x=s.getParameterByName("useWixCodeFallback"),(!t.isOpen("sv_wixCodeForceWorkerForSEO",i)||!window.Worker)&&"false"!==x&&("true"===x||!window.Worker||p)),S={isMobileView:a,namespacesSdkSource:f,externalComponentsSource:m,wixCodeNamespacesAndElementorySupportSource:g,wixCodeViewerAppSource:w,runtimeSource:s.getParameterByName("WixCodeRuntimeSource"),ReactSource:s.getParameterByName("ReactSource"),useWixCodeFallback:v,isDebug:c,currentUrl:d},M=s.getParameterByName("viewerPlatformAppSources"),y=s.getParameterByName("controllersUrlOverride");var x;S.applications=r.appsUtils.getAppsBaseInfo({rendererModel:i.rendererModel,clientSpecMap:i.rendererModel.clientSpecMap,serviceTopology:i.serviceTopology,viewerPlatformAppSources:M,currentUrl:d,santaBase:i.santaBase,controllersUrlOverride:y}),u=i.rendererModel.clientSpecMap,o.init(i,u,S),function(e){return r.specMapUtils.getAppSpec(e)||S.applications.length}(u)&&(t.isOpen("sv_moveWixCodeToViewerApp",i)||o.preLoadUserCode(i,d),i.publicModel&&o.preLoadWidgets(i,d))}}.apply(r,n))||(e.exports=o)},33:function(e,r){e.exports=n},51:function(e,r){e.exports=o},8:function(e,r){e.exports=t}})});
//# sourceMappingURL=wixCodeInit.min.js.map