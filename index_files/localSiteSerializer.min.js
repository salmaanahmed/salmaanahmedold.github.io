define("localSiteSerializer",["lodash","coreUtils","utils"],function(e,t,n){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=881)}({0:function(t,n){t.exports=e},1:function(e,n){e.exports=t},16:function(e,t){e.exports=n},881:function(e,t,n){var r,a;r=[n(0),n(882),n(892)],void 0===(a=function(e,t,n){"use strict";return function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.plugins,o=void 0===a?Object.values(t):a,i=r.encodeWhenSerializing,u=void 0===i||i,s=function(t){var n=Object.assign({},o.reduce(function(n,r){var a=r.serialize;return e.merge(n,a(t))},{}),{documentSchemaVersion:"1.0"});return u?d(n):n},c=function(t){var n=u?p(t):t;return e(o).reverse().reduce(function(t,r){var a=r.deserialize;return e.merge(t,a(n))},{})},d=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.encode,a=e.cloneDeep(t);return o.reduce(function(n,o){return o.getEncryptedPaths(a).forEach(function(a){var o=e.get(t,a);o&&e.set(n,a,r(o))}),n},a)},p=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.decode;return d(e,t)};return{serialize:s,deserialize:c,encode:d,decode:p}}}.apply(t,r))||(e.exports=a)},882:function(e,t,n){var r,a;r=[n(0),n(883),n(884),n(886),n(887),n(888),n(889),n(890),n(891)],void 0===(a=function(e,t,n,r,a,o,i,u,s){"use strict";return{styles:t,layout:s,pages:r,menu:u,background:i,commonComponents:n,routers:o,siteInfo:a}}.apply(t,r))||(e.exports=a)},883:function(e,t,n){var r,a;r=[n(0)],void 0===(a=function(e){"use strict";return{serialize:function(t){var n=t.pagesData,r=n.masterPage.data.theme_data;return e.unset(n.masterPage.data,"theme_data"),{styles:{colors:r.THEME_DATA.color,fonts:r.THEME_DATA.font,theme:e.omit(r.THEME_DATA,"color","font"),topLevelStyles:e.omit(r,"THEME_DATA")}}},deserialize:function(e){var t=e.styles;return{pagesData:{masterPage:{data:{theme_data:Object.assign({THEME_DATA:Object.assign({color:t.colors,font:t.fonts},t.theme)},t.topLevelStyles)}}}}},getEncryptedPaths:function(){return["styles.colors","styles.fonts","styles.theme","styles.topLevelStyles"]}}}.apply(t,r))||(e.exports=a)},884:function(e,t,n){var r,a;r=[n(0),n(885)],void 0===(a=function(e,t){"use strict";return{serialize:function(n){var r,a,o,i,u,s=n.pagesData,c=s.masterPage.data;return e.unset(s.masterPage,"data"),{site:{commonComponents:{structure:t((r=s.masterPage.structure,a=e.findIndex(r.children,{id:"PAGES_CONTAINER"}),o=e.findIndex(r.children,{id:"SITE_FOOTER"}),i=e.findIndex(r.children[a].components,{id:"SITE_PAGES"}),u=e.get(r,"children["+a+"].layout.y"),e.set(r,"children["+a+"].layout.height",400),e.set(r,"children["+o+"].layout.y",400+u),e.set(r,"children["+a+"].components["+i+"].layout.height",400),r)),data:c}}}},deserialize:function(e){return{pagesData:{masterPage:e.site.commonComponents}}},getEncryptedPaths:function(){return["site.commonComponents"]}}}.apply(t,r))||(e.exports=a)},885:function(e,t,n){var r,a;r=[n(0)],void 0===(a=function(e){"use strict";function t(e,t){return e.localeCompare(t)}return function n(r){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,o=void 0;return Array.isArray(r)?r.map(function(e){return n(e,a)}):e.isPlainObject(r)?(o={},Object.keys(r).sort(a).forEach(function(e){o[e]=n(r[e],a)}),o):r}}.apply(t,r))||(e.exports=a)},886:function(e,t,n){var r,a;function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}r=[n(0)],void 0===(a=function(e){"use strict";var t=function(e,t){return e?o({},t,e):{}};return{serialize:function(n){var r=n.pagesData,a=n.rendererModel,o=n.pagesPlatformApplications,i=e.reduce(o,function(t,n,r){return e.reduce(n,function(e,t,n){return e[n]=e[n]||[],e[n].push(r),e},t)},{});return{pages:Object.keys(r).filter(function(e){return"masterPage"!==e}).reduce(function(n,o){var u=r.masterPage.data.document_data[o],s=u.pageUriSEO,c=u.title,d=u.isPopup,p=u.id;return n[o]={pageUriSeo:s,title:c,isPopup:d,pageId:p,content:Object.assign({},r[o],t(e.get(i,o),"pagesPlatformApplications"),t(a.passwordProtectedPages&&a.passwordProtectedPages.find(function(e){return e===o}),"passwordProtectedPages"))},e.unset(r.masterPage.data.document_data[o],"pageUriSEO"),e.unset(r.masterPage.data.document_data[o],"title"),n},{})}},deserialize:function(t){return{pagesData:Object.keys(t.pages).filter(function(e){return"masterPage"!==e}).reduce(function(n,r){var a;return Object.assign(n,(o(a={},r,Object.assign(t.pages[r].content,{title:t.pages[r].title,pageUriSEO:t.pages[r].pageUriSeo})),o(a,"masterPage",e.merge(n.masterPage,{data:{document_data:o({},r,{isPopup:t.pages[r].isPopup,title:t.pages[r].title,pageUriSEO:t.pages[r].pageUriSeo,id:t.pages[r].pageId})}})),a))},{}),rendererModel:Object.keys(t.pages).filter(function(e){return"masterPage"!==e}).reduce(function(e,n){var r=t.pages[n].content;return r.pagesPlatformApplications&&(e.pagesPlatformApplications[n]=r.pagesPlatformApplications),delete r.pagesPlatformApplications,e.passwordProtectedPages=e.passwordProtectedPages.concat(r.passwordProtectedPages?r.passwordProtectedPages:[]),delete r.passwordProtectedPages,e},{pagesPlatformApplications:{},passwordProtectedPages:[]})}},getEncryptedPaths:function(e){return Object.keys(e.pages).map(function(e){return"pages."+e+".content"})}}}.apply(t,r))||(e.exports=a)},887:function(e,t,n){var r;void 0===(r=function(){"use strict";return{serialize:function(e){var t=e.documentServicesModel,n=e.rendererModel;return{site:Object.assign({},{siteInfo:n.siteInfo,version:{version:t.version,revision:t.revision}},n.multilingualInfo?{multilingualInfo:n.multilingualInfo}:{})}},deserialize:function(e){return{documentServicesModel:Object.assign(e.site.version),rendererModel:Object.assign({siteInfo:e.site.siteInfo},e.site.multilingualInfo?{multilingualInfo:e.site.multilingualInfo}:{})}},getEncryptedPaths:function(){return["site.siteInfo","site.revision","site.version","site.dataFromMasterPage","site.multilingualInfo"]}}}.apply(t,[]))||(e.exports=r)},888:function(e,t,n){var r,a;function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}r=[n(0)],void 0===(a=function(e){"use strict";return{serialize:function(t){var n=t.routers,r=e.get(n,"configMap",{});return{routers:Object.keys(r).reduce(function(e,t){return Object.assign(e,o({},r[t].prefix,Object.assign({},r[t],{routeId:t})))},{})}},deserialize:function(t){return{rendererModel:{routers:{configMap:Object.keys(t.routers).reduce(function(n,r){return e.merge(n,o({},t.routers[r].routeId,Object.assign({},e.omit(t.routers[r],"routeId"),{prefix:r})))},{})}}}},getEncryptedPaths:function(e){return Object.keys(e.routers).map(function(e){return"routers."+e})}}}.apply(t,r))||(e.exports=a)},889:function(e,t,n){var r,a;r=[n(0),n(16),n(1)],void 0===(a=function(e,t,n){"use strict";var r=t.siteUtils,a=function(t,n,a){return r.getPageBackgroundDataPointers(a,[n]).reduce(function(t,n){var r=n.path;return e.get(a,r)&&(e.set(t,r,e.get(a,r)),e.unset(a,r)),t},{})},o=function(t,n,a){return r.getPageBackgroundDataPointers(n.content,[a]).forEach(function(r){var a=r.path;e.get(n.content,a)&&(e.set(t,a,e.get(n.content,a)),e.unset(n.content,a))}),t};return{serialize:function(t){var r=t.pagesData,o=r[n.siteConstants.MASTER_PAGE_ID];return{pages:e(r).omit("masterPage").mapValues(function(e,t){return{content:a(0,t,o)}}).value()}},deserialize:function(t){var n=t.pages;return{pagesData:{masterPage:e(n).omit("masterPage").reduce(o,{data:{document_data:{}}})}}},getEncryptedPaths:function(e){return Object.keys(e.pages).map(function(e){return"pages."+e+".content"})}}}.apply(t,r))||(e.exports=a)},890:function(e,t,n){var r,a;function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}r=[n(0)],void 0===(a=function(e){"use strict";var t=["PageLink","AnchorLink"],n=function(e){return e.replace(/^#/,"")};return{serialize:function(r){var a,i,u=r.pagesData,s={menus:{},pages:{}},c=(a=u.masterPage,i=a.data.document_data,e(i).get("CUSTOM_MENUS.menus",[]).reduce(function(t,r){var a=n(r),o=e.get(i,a);return e.set(t,a,o)},{})),d=e.reduce(c,function(t,r,a){return e.set(t,a,function(t,r){return e.flattenDeep(function r(a){var o=a.dataId,i=a.parent,u=void 0===i?null:i,s="data.document_data."+n(o),c=[],d=e.get(t,s+".items");return d.length>0&&c.push(d.map(function(e){return r({dataId:e,parent:n(o)})})),c.concat([{path:s,parent:u}])}({dataId:r}))}(u.masterPage,a))},{});return e.forEach(d,function(r,a){s.menus[a]=s.menus[a]||{data:{},structure:{}},e.forEach(r,function(r){var i=r.path,c=e.get(u.masterPage,i),d=c.link&&e.get(u.masterPage,"data.document_data."+n(c.link)),p=e.assign({},o({},c.id,e.omit(c,"items")),d?o({},d.id,d):{});if(e.set(s.menus[a],"structure."+c.id,{id:c.id,items:c.items}),d&&t.includes(d.type)){var l=n(d.pageId);e.set(s.pages,l+".content.menus."+a,p)}else e.merge(s.menus[a].data,p);e.forEach(p,function(t,n){return e.unset(u.masterPage.data.document_data,n)}),e.unset(u.masterPage,i)})}),s},deserialize:function(t){return{pagesData:{masterPage:{data:{document_data:e.reduce(t.menus,function(r,a,o){var i,u=a.structure,s=a.data,c=e(u).map("items").flattenDeep().map(n).value(),d=e.reduce(t.pages,function(t,n){return e.assign(t,e.get(n.content,"menus."+o),{})},{}),p=e(d).filter(function(e){return"BasicMenuItem"===e.type&&!c.includes(e.id)}).map(function(e){return"#"+e.id}).value();return(i=u[o].items).push.apply(i,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(p)),e.merge(r,d,s,u,p)},{})}}}}},getEncryptedPaths:function(t){return e(t.menus).keys().map(function(e){return"menus."+e}).concat(e(t.pages).keys().map(function(e){return"pages."+e+".content.menus"}).value()).value()}}}.apply(t,r))||(e.exports=a)},891:function(e,t,n){var r,a;r=[n(0),n(1)],void 0===(a=function(e,t){"use strict";return{serialize:function(n){var r=n.pagesData;return{pages:e(r).omit(t.siteConstants.MASTER_PAGE_ID).mapValues(function(t,n){return a=r[n].structure,e.unset(a,"layout.width"),e.set({},"content.structure.layout.width",980);var a}).value()}},deserialize:e.noop,getEncryptedPaths:function(){return[]}}}.apply(t,r))||(e.exports=a)},892:function(e,t,n){var r,a;r=[n(0)],void 0===(a=function(e){"use strict";return{encode:function(t){return e.flow([JSON.stringify,encodeURIComponent,unescape,btoa])(t)},decode:function(t){return e.flow([atob,escape,decodeURIComponent,JSON.parse])(t)}}}.apply(t,r))||(e.exports=a)}})});
//# sourceMappingURL=localSiteSerializer.min.js.map