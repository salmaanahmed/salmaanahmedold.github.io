(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.elementorySupport=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";var elementorySupportFactory=require("./with-xhr");module.exports=elementorySupportFactory()},{"./with-xhr":3}],2:[function(require,module,exports){"use strict";module.exports={PARSE:"parsererror",ERROR:"error",ABORT:"abort",TIMEOUT:"timeout"}},{}],3:[function(require,module,exports){"use strict";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(t,!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(t).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var wireFormat=require("../common/wire-format"),getPathWithBaseUrl=require("../common/paths"),errorTypes=require("./error-types"),THIRTY_SECONDS=3e4;module.exports=function(e,r,t){return{baseUrl:e,queryParameters:r,currentPath:t,options:arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},errorTypes:errorTypes,wireFormatParser:wireFormat.wireFormatParser,getJSON:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=this.currentPath?location.href.replace(this.currentPath,e):getPathWithBaseUrl(this.baseUrl,e,this.queryParameters),o=this.options,n=o.headers,s=void 0===n?{}:n,a=o.withCredentials,i=void 0!==a&&a,c=o.timeout,u=void 0===c?THIRTY_SECONDS:c,p=_objectSpread({},s,{"Content-Type":"application/json"});return new Promise(function(e,o){var n=new XMLHttpRequest;function s(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=new Error(r);return t.xhr=n,t.errorType=e,t}n.withCredentials=i;var a=setTimeout(function(){o(s(errorTypes.TIMEOUT)),n.abort()},u);n.open("POST",t,!0),n.onerror=function(){return o(s(errorTypes.ERROR,n.statusText))},n.onreadystatechange=function(){if(4===n.readyState)if(clearTimeout(a),200===n.status)try{var r=wireFormat.fromJson(n.responseText),t=r.isError,i=r.payload;t?o(i):e(i)}catch(e){o(s(errorTypes.PARSE,e.message))}else{var c=n.status?errorTypes.ERROR:errorTypes.ABORT;o(s(c,n.statusText))}},Object.keys(p).forEach(function(e){return n.setRequestHeader(e,p[e])}),n.send(wireFormat.toArgsFormat(r))})}}}},{"../common/paths":4,"../common/wire-format":8,"./error-types":2}],4:[function(require,module,exports){"use strict";var sanitize=function(t){return t.startsWith("?")||t.startsWith("&")?t.substr(1):t};module.exports=function(t,n,c){if(!c)return t+n;var r=sanitize(c);return-1===n.indexOf("?")?"".concat(t).concat(n,"?").concat(r):"".concat(t).concat(n,"&").concat(r)}},{}],5:[function(require,module,exports){"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var i=0;i<r.length;i++){var t=r[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,r,i){return r&&_defineProperties(e.prototype,r),i&&_defineProperties(e,i),e}var _require=require("./values-mapper"),mapValues=_require.mapValues,DefaultSerializer=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"canSerialize",value:function(){return!0}},{key:"serialize",value:function(e,r){return r&&void 0===e?null:e}},{key:"canDeserialize",value:function(){return!0}},{key:"deserialize",value:function(e){return e}}]),e}(),isAnObjectButNotNull=function(e){return null!==e&&"object"===_typeof(e)};module.exports=function(){function e(){_classCallCheck(this,e);for(var r=arguments.length,i=new Array(r),t=0;t<r;t++)i[t]=arguments[t];this.serializers=[].concat(i,[new DefaultSerializer])}return _createClass(e,[{key:"serialize",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(isAnObjectButNotNull(e)){if(r.has(e))throw new TypeError("Converting circular structure to JSON");r.add(e)}if(Array.isArray(e))return this._serializeArray(e,r);var t=this.findSerializer(e).serialize(e,i);return isAnObjectButNotNull(e)?this._serializeObject(t,e,r):t}},{key:"_serializeObject",value:function(e,r,i){var t,n=this;return t="function"==typeof e.toJSON?mapValues(e.toJSON(),function(e){return n.serialize(e,i)}):mapValues(e,function(e){return n.serialize(e,i)}),i.delete(r),t}},{key:"_serializeArray",value:function(e,r){var i=this,t=e.map(function(e){return i.serialize(e,r,!0)});return r.delete(e),t}},{key:"deserialize",value:function(e){var r=this,i=e;return Array.isArray(e)?i=e.map(function(e){return r.deserialize(e)}):isAnObjectButNotNull(e)&&(i=mapValues(e,this.deserialize.bind(this))),this.findDeserializer(i).deserialize(i)}},{key:"findDeserializer",value:function(e){return this.serializers.find(function(r){return r.canDeserialize(e)})}},{key:"findSerializer",value:function(e){return this.serializers.find(function(r){return r.canSerialize(e)})}}]),e}()},{"./values-mapper":7}],6:[function(require,module,exports){"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var OBJECT_TAG_FIELD="__ctorName";exports.DateSerializer=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"canSerialize",value:function(e){return e instanceof Date}},{key:"serialize",value:function(e){return{$date:e.toISOString()}}},{key:"canDeserialize",value:function(e){return e&&"object"===_typeof(e)&&"$date"in e}},{key:"deserialize",value:function(e){return new Date(e.$date)}}]),e}(),exports.ObjectTaggingSerializer=function(){function e(t){_classCallCheck(this,e),this.className=t.name,this.classConstructor=t}return _createClass(e,[{key:"canSerialize",value:function(e){return e&&e[OBJECT_TAG_FIELD]===this.className}},{key:"serialize",value:function(e){return Object.assign(e.toJSON(),_defineProperty({},OBJECT_TAG_FIELD,this.className))}},{key:"canDeserialize",value:function(e){return e&&e[OBJECT_TAG_FIELD]===this.className}},{key:"deserialize",value:function(e){return this.classConstructor.fromJSON(e)}}]),e}()},{}],7:[function(require,module,exports){"use strict";function mapValues(a,e){var r={};return Object.keys(a).forEach(function(s){var t=e(a[s]);void 0!==t&&(r[s]=t)}),r}exports.mapValues=mapValues},{}],8:[function(require,module,exports){"use strict";function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r)){for(var e=0,t=new Array(r.length);e<r.length;e++)t[e]=r[e];return t}}var SerializerRegistry=require("./serializer-registry"),_require=require("./serializers"),DateSerializer=_require.DateSerializer,registry=new SerializerRegistry(new DateSerializer);function convertResult(r){if(!r)return r;if(r._elementoryError){var e=new Error(r.message);return e.stack=r.stack,e.name=r.name,e.code=r.code,e}return r}exports.wireFormatParser=function(r){return registry.deserialize(r)},exports.fromJson=function(r){var e=JSON.parse(r),t=exports.wireFormatParser(e);return{isError:!!t.exception,payload:convertResult(t.result)}},exports.toJson=function(r){return registry.serialize(r)},exports.toArgsFormat=function(r){return r&&"[object Arguments]"===Object.prototype.toString.call(r)?JSON.stringify(registry.serialize(_toConsumableArray(r))):JSON.stringify([])}},{"./serializer-registry":5,"./serializers":6}]},{},[1])(1)});