$(document).ready(function(){function e(e){switch(e.errors&&$.each(e.errors,function(){}),b){case"contacts":return i(e);default:return o()}}function t(){k[0].reset()}function a(e){$([document.documentElement,document.body]).animate({scrollTop:e},200)}function o(){var e=y.offset().top;y.addClass("fadeOut animated"),C<800?(a(e-150),setTimeout(function(){y.height(350),w.addClass("show")},500)):w.addClass("show")}function n(e){var t=$(".projects-preview .col"),a='<div class="col col-sm-4">\n   <a href="{{HREF}}" class="project-link">\n        <div class="project-item">\n             <div class="project-img"><img class="img " src="{{IMG_SRC}}" alt=""></div>\n             <p class="project-title">{{TITLE}}</p>\n             <p class="project-descr">{{DESCRIPTION}}</p>\n        </div>\n   </a>\n</div>';e.forEach(function(e){var o=$(a.replace("{{HREF}}",e.link).replace("{{IMG_SRC}}",e.image).replace("{{TITLE}}",e.title).replace("{{DESCRIPTION}}",e.subtitle));t.append(o)})}function i(e){n(e),y.addClass("fadeOut animated"),C<800&&y.height(350),a(0),setTimeout(function(){w.addClass("show"),x.addClass("show-projects"),L.removeClass("section--bg-white-smoke"),L.addClass("section--bg-black"),L.attr("data-bg","black"),t()},300)}function s(){if($("#contact_privacy_policy_accepted").closest(".form-checkbox").hasClass("form-checkbox--checked"))$("#checkbox-error").remove();else if(!$("#contact_privacy_policy_accepted").closest(".form-checkbox").hasClass("form-checkbox--checked")&&0===$("#checkbox-error").length){var e='<div id="checkbox-error" class="form-checkbox__msg">Mere formality, agree to our Privacy Policy<br> to send your message</div>';$("#contact_privacy_policy_accepted").closest(".form-checkbox").closest(".form-checkbox").append(e)}}function r(e){function t(){l-=3e-5,p+=.03,u.setLngLat([d,l]),u.addTo(s),l>=m&&(requestAnimationFrame(t),r.style.opacity=p.toString())}function a(){var e="linear-gradient(to left, rgba(35, 37, 44, 0.41), rgba(35, 37, 44, 0.76)"+_+"%, rgba(35, 37, 44, 0.8))";_<=60&&(f.style.background=e,_++,requestAnimationFrame(a))}mapboxgl.accessToken="pk.eyJ1IjoiYXJ0ZW1ob3JvYmVpIiwiYSI6ImNqbWc3ZGZhcDE4bnczdm85MnY0YnFodGoifQ.2I0c-QABSnZwIMwV-ubPYQ";var o={Lng:35.06922852,Lat:48.45184123},n={Lng:24.76309,Lat:59.43889},i=$(".map-container").height(),s=new mapboxgl.Map({container:e,center:[n.Lng,n.Lat],style:"mapbox://styles/mapbox/dark-v9",zoom:14,minZoom:6});900===i&&s.panBy([-400,-50]);var r=document.createElement("div");r.id="map-marker",r.className="map-marker",r.style.backgroundImage='url("https://yalantis.com/assets/v3/icons/icon-shape-bf468712779b144f64221e4b1390271c26bd2f0d244b2df41a73d50e9bb37d0e.png")',r.style.opacity="0";var l,d,m,f=$(".blur")[0],u=new mapboxgl.Marker(r),p=0,h=.001,_=0,g=function(e){e?(d=o.Lng,m=o.Lat):(d=n.Lng,m=n.Lat),l=m+h,u.setLngLat([d,m]),requestAnimationFrame(t)};new ScrollMagic.Scene({triggerElement:["#",e].join(""),triggerHook:.85,reverse:!1}).addTo(c).on("enter",function(){this.off("enter");var e=new TimelineMax,t=TweenMax.staggerFrom($(".section__title"),.4,{yPercent:30,opacity:0},.2),o=TweenMax.from($(".address-block"),.4,{yPercent:50,opacity:0,delay:-.8,onComplete:function(){$(".splitter").addClass("isAppeared").one("transitionend webkitTransitionEnd oTransitionEnd otransitionend MSTransitionEnd",function(e){$(e.target).addClass("isAppearanceAnimationCompleted")})}}),n=TweenMax.from([$(".address-value-mob"),$(".address-block__title")],.4,{yPercent:50,opacity:0,delay:-.5}),i=TweenMax.from([$(".address-block-mob"),$(".address-block__value")],.4,{yPercent:50,opacity:0,delay:-.5});e.add(t).add(o).add(n).add(i),this.setTween(e),requestAnimationFrame(a),setTimeout(g,800)}),s.scrollZoom.disable();var v=$("#estonia"),b=$("#ukraine"),y=$("#estonia-mob"),k=$("#estonia-address"),C=$("#ukraine-mob"),w=$("#ukraine-address");v.click(function(){r.style.opacity="0",p=0,s.setCenter([n.Lng,n.Lat]).panBy([-400,-50]),v.addClass("selected"),b.removeClass("selected"),setTimeout(g,500)}),y.click(function(){s.setCenter([n.Lng,n.Lat]),new mapboxgl.Marker(r).setLngLat([n.Lng,n.Lat]).addTo(s),y.addClass("selected"),C.removeClass("selected"),k.removeClass("hide"),w.addClass("hide")}),b.click(function(){r.style.opacity="0",p=0,s.setCenter([o.Lng,o.Lat]).panBy([-400,-50]),v.removeClass("selected"),b.addClass("selected"),setTimeout(g,500,!0)}),C.click(function(){s.setCenter([o.Lng,o.Lat]),new mapboxgl.Marker(r).setLngLat([o.Lng,o.Lat]).addTo(s),y.removeClass("selected"),C.addClass("selected"),k.addClass("hide"),w.removeClass("hide")})}AppYalantis.FormCheckbox.init(),autosize(document.getElementById("contact_comment"));var c=new ScrollMagic.Controller,l="min",d=0,m=0,f=1e6,u=2e4,p=$(".form-toggler"),h=$(".form-field__input"),_=$(".form-tag__input"),g=$(".accept-required"),v=$("#new_contact"),b=$("body").data("page"),y=$(".sender__content"),k=(y.find(".section__heading"),y.find(".form-contacts")),C=$(window).height(),w=$(".form-confirmation"),x=$(".projects-preview"),L=$(".service-block");p.click(function(e){e.preventDefault(),$(this).parent(".section__control").fadeOut(300),$(".sender .section__intro").fadeOut(300),setTimeout(function(){$(".sender .form").slideDown(300)},300)}),h.blur(function(){$(this).parent(h).removeClass("form-field--active"),0===$(this).val().length?$(this).parent($(".form-field")).removeClass("form-field--filled"):$(this).parent($(".form-field")).addClass("form-field--filled")}),h.focus(function(){$(this).parent($(".form-field")).addClass("form-field--active")}),_.change(function(){$(this).is(":checked")?$(this).closest($(".form-tag")).addClass("form-tag--checked"):$(this).closest($(".form-tag")).removeClass("form-tag--checked"),0===$(".form-tag--checked").length?$(".form-tags").removeClass("form-tags--filled"):$(".form-tags").addClass("form-tags--filled")}),$(".form label").keydown(function(e){13==e.which&&($(this).click(),$(this).focus())}),v.validate({rules:{"contact[name]":{required:!0,only_letters_name:!0,min_size_name:!0,max_size_name:!0},"contact[email]":{required:!0,correct_email:!0,min_size_email:!0,max_size_email:!0},"contact[comment]":{required:!0,min_size_comment:!0,max_size_comment:!0,only_letters_comment:!0}},messages:{"contact[name]":{required:"Would you tell us your name?"},"contact[email]":{required:"Would you tell us your email?",correct_email:"Sorry, looks like your email is invalid.<br> Let\u2019s try again!"},"contact[comment]":{required:"Share brief details, please. "}},focusInvalid:!1,errorClass:"form-field__msg",errorElement:"div",highlight:function(e){$(e).closest(".form-field").addClass("form-field--error")},unhighlight:function(e){$(e).closest(".form-field").removeClass("form-field--error")},errorPlacement:function(e,t){$(t).closest(".form-field").append(e)}}),$.validator.addMethod("correct_email",function(e,t){return this.optional(t)||!!e.match(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.[a-z]{2,3})+$/)},"Enter correct email"),$.validator.addMethod("min_size_email",function(e,t){return!!(this.optional(t)||e.replace(/\s/g,"").length>=5)},"Is too short (minimum is 2 characters)"),$.validator.addMethod("max_size_email",function(e,t){return!(this.optional(t)||e.replace(/\s/g,"").length>256)},"Is too long (maximum is 256 characters)"),$.validator.addMethod("min_size_name",function(e,t){return!!(this.optional(t)||e.replace(/\s/g,"").length>=2)},"Is too short (minimum is 2 characters)"),$.validator.addMethod("max_size_name",function(e,t){return!(this.optional(t)||e.replace(/\s/g,"").length>256)},"Is too long (maximum is 256 characters)"),$.validator.addMethod("only_letters_name",function(e,t){return!(!this.optional(t)&&e.match(/[\d`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi))},"Please use only letters"),$.validator.addMethod("min_size_comment",function(e,t){return!!(this.optional(t)||e.replace(/\s/g,"").length>=2)},"Is too short (minimum is 2 characters)"),$.validator.addMethod("max_size_comment",function(e,t){return!(this.optional(t)||e.replace(/\s/g,"").length>1e3)},"Is too long (maximum is 1000 characters)"),$.validator.addMethod("only_letters_comment",function(e,t){return!(!this.optional(t)&&e.match(/[{}&*~|`^<\/]/gi))},"{}&*~|`^</ characters are not allowed"),v.submit(function(t){if(t.preventDefault(),s(),0===$(".form-field--error").length&&0===$("#checkbox-error").length){var a=$(this).find("input[name='contact[name]']").val(),o=$(this).find("input[name='contact[email]']").val(),n=($(this).find("input[name='contact[nickname]']").val(),$(".form-slider__scale").slider("value").toString()),i=$(this).find("textarea[name='contact[comment]']").val(),r=$(".form-checkbox__input[name='contact[privacy_policy_accepted]']").val(),c=$(".form-checkbox__input[name='contact[send_nda]']").val(),l=[];files_ids=[],$(this).find("input[name='files_ids[]']").each(function(){files_ids.push($(this).val())}),$(".tags-list__item").each(function(){$(this).find(".form-tag").hasClass("form-tag--checked")&&l.push($(this).find('.form-tag__input[type="checkbox"]').val())}),$.ajax({type:"POST",url:window.location.origin+"/contacts/",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))},data:{contact:{name:a,email:o,nickname:"",budget:n,help_types:l,comment:i,privacy_policy_accepted:r,send_nda:c},files_ids:files_ids},success:function(t){e(t)},error:function(e){console.log("error "+e)}})}}),$(g).change(function(){s()}),$(".form-slider__scale").slider({range:l,value:d,min:m,max:f,step:u,slide:function(e,t){var a=t.value.toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1,");t.value===m?($(".form-slider__label").html("Your budget"),$(".form-slider").removeClass("form-slider--filled")):t.value===f?($(".form-slider__label").html("Your budget is <span class='form-slider__amount'>$ "+a+"</span> or more"),$(".form-slider").addClass("form-slider--filled")):($(".form-slider__label").html("Your budget is up to <span class='form-slider__amount'>$ "+a+"</span>"),$(".form-slider").addClass("form-slider--filled")),$(".form-slider__scale-dot").each(function(e){var a=$(this);e<t.value/2e5?a.addClass("form-slider__scale-dot--filled"):a.removeClass("form-slider__scale-dot--filled")}),$(".form-slider__input").val(t.value)}}).each(function(){for(var e=$(this).data().uiSlider.options,t=e.max-e.min,a=0;a<=t;a++)if(a%2e5==0){var o=$('<span class="form-slider__scale-dot"></span>').css("left",a/t*100+"%");$(".form-slider__scale").append(o)}}),$(".form-slider__scale").draggable(),$(".form-slider__input").val("$"+$("#form-slider").slider("value"));var T=function(e,t){var a=new XMLHttpRequest,o={progress:function(){},complete:function(){},error:function(){}},n=function(e){var t=-1,a=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do{e/=1024,t++}while(e>1024);return Math.max(e,.1).toFixed(1)+a[t]};a.upload.onprogress=function(e){var t=Math.floor(e.loaded/e.total*100);o.progress(t)},a.onreadystatechange=function(){try{4===a.readyState&&(200===a.status?o.complete(JSON.parse(a.response)):o.error(a))}catch(e){o.error(new Error("Bad response body"))}},this.start=function(){var o=new FormData;return o.append("size",this.size()),o.append("origin_name",this.name()),o.append("file",t),a.open("POST",window.location.origin+e,!0),a.send(o),this},this.progress=function(e){return o.progress=e,this},this.complete=function(e){return o.complete=e,this},this.error=function(e){return o.error=e,this},this.name=function(){return t.name},this.size=function(){return n(t.size)},this.validateSize=function(e){var a=t.size<20971520;return a||e(),a}},M=function(e,t){var a='<li class="attached-files__item"><span class="attached-files__item-progress"></span><span class="attached-files__item-size">'+t.size()+'</span><span class="attached-files__item-name" title="'+t.name()+'">'+t.name()+'</span><button class="attached-files__item-delete"></button></li>';t.progress(function(e){this.elem.find(".attached-files__item-progress").css({width:e+"%"})}.bind(this)),this.elem=$(a),this.render=function(){e.append(this.elem)},this.getElem=function(){return this.elem}},E=$("#contacts-attach-list");$("#attach-file-button").on("change",function(e){Array.prototype.forEach.call(e.target.files,function(e){var t=new T("/contacts/files/",e),a=new M(E,t);t.validateSize(function(){alert("Please attach files less than 20 MB")})&&(a.render(),$("#contacts-submit-button").prop("disabled",!0),t.complete(function(e){var t=$("<input>").attr("type","hidden").attr("name","files_ids[]").val(e.file.id);a.getElem().data("id",e.file.id),v.append(t),$("#contacts-submit-button").prop("disabled",!1)}).error(function(e){$("#contacts-submit-button").prop("disabled",!1),a.elem.remove(),console.error(e,a)}).start())})}),E.on("click",".attached-files__item-delete",function(e){var t=$(this).parent("li");e.preventDefault(),$.ajax({type:"DELETE",url:window.location.origin+"/contacts/files/"+t.data().id,success:function(){t.remove()}})});var z=document.createElement("script");z.src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.js",z.onload=function(){$("#map").length>0&&r("map")},document.body.appendChild(z)});