var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],o=!0,i=!1,a=void 0;try{for(var r,p=e[Symbol.iterator]();!(o=(r=p.next()).done)&&(n.push(r.value),!t||n.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{!o&&p.return&&p.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}define("platform/bi/events.json",[],function(){return{CONTROLLER_GFPP_CLICK:{evid:26,src:79,endpoint:"platform",fields:{app_name:"string",action_name:"string",controller_type:"string",component_id:"string",pageId:"string"}},page_delete_dataset:{evid:91,src:79,endpoint:"platform",fields:{app_name:"string",controller_type:"string",component_id:"string",pageId:"string"}}}}),define("platform/common/constants",["constants"],function(e){"use strict";return{EDITOR_API_NS:"editorAPI",PLATFORM_PANEL:"PLATFORM_PANEL",PLATFORM_ON_EVENT:"PLATFORM_ON_EVENT",PLATFORM_SDK_ALIVE:"PLATFORM_SDK_ALIVE",PLATFORM_SDK_READY:"PLATFORM_SDK_READY",CONTROLLER_COMPONENT_TYPES:["platform.components.AppController","platform.components.AppWidget"],TPA_WIDGET_TYPE_TEMPLATE:{qname:{prefix:"$w",shortName:"IFrame"},componentType:"wysiwyg.viewer.components.tpapps.TPAWidget",tagName:"",members:null,events:null,baseTypes:{},inheritanceChain:null},EVENTS:{controllerSettingsButtonClicked:"controllerSettingsButtonClicked",componentConnectButtonClicked:"componentConnectButtonClicked",createCollectionButtonClicked:"openCreateNewCollection",addExternalDbDriverClicked:"addExternalDbDriverClicked",editExternalDbDriverClicked:"editExternalDbDriverClicked",removeExternalDbDriverClicked:"removeExternalDbDriverClicked",formBuilderAppClicked:"formBuilderAppClicked",enableDataModeClicked:"enableDataModeClicked",openAddPreset:"openAddPreset"},panelTypes:{COMPONENT_PANEL:"platformPanels.componentPanel",FULL_STAGE:"platformPanels.fullStagePanel",MODAL:"platformPanels.modalPanel",TOOL:"platformPanels.toolPanel",DOCKED:"platformPanels.sidePanel",DASHBOARD:"platformPanels.dashboardPanel"},pages:{page_settings:{layout:{type:e.PAGE_SETTINGS_TABS.LAYOUT,fallbackType:"Pages_Layouts_Tab_Title"},permissions:{type:e.PAGE_SETTINGS_TABS.PERMISSIONS,fallbackType:"Pages_Permissions_Tab_Title"},pageInfo:{type:e.PAGE_SETTINGS_TABS.PAGE_INFO},seo:{type:e.PAGE_SETTINGS_TABS.SEO}},page_actions:{rename:{title:"Pages_Actions_Page_Rename",type:"Pages_Actions_Page_Rename",icon:"quickActionsRename"}}},members:{router_actions:{view_site_members:{title:"Pages_Panel_MemberMenu_SiteMembers_Link",type:"view_site_members",icon:"goToURLAction"},open_signup_settings:{title:"Pages_Panel_MemberMenu_SignupSettings_Link",type:"open_signup_settings",icon:"membersAction"}}},controller:{DEFAULT_STATE:"default"},ORIGIN:{INITIATOR:{EDITOR:"EDITOR",APP:"APP"},TYPE:{ADD_PANEL:"ADD_PANEL",APP_MARKET:"APP_MARKET",DEV_MODE_ON:"DEV_MODE_ON",IMPORT_PANEL:"IMPORT_PANEL"}},GFPP:{mainActionNames:{MAIN_ACTION1:"mainAction1",MAIN_ACTION2:"mainAction2",DEPRECATED_MAIN_ACTION:"mainAction"}}}}),define("platform/appController/controllerSettingsGfpp",["lodash","platformEvents","constants","platform/bi/events.json","platform/common/constants"],function(g,P,e,A,t){"use strict";var o={dataset:"7f921134-acd3-4771-ac24-33bbeafefb90",router_dataset:"7f921134-acd3-4771-ac24-33bbeafefb90"},v="gfpp_mainaction_dataset",I=t.GFPP.mainActionNames,n={untranslatable:!0,mainActions:function(e,t){var n=[],o=e.platform.controllers.getStageData(g.head(t)),i=g.get(o,["gfpp",I.MAIN_ACTION1])?I.MAIN_ACTION1:I.DEPRECATED_MAIN_ACTION,a=g.get(o,["gfpp",i]),r=g.get(o,["gfpp",I.MAIN_ACTION2]);a&&n.push(p(i,o));r&&n.push(p(I.MAIN_ACTION2,o));return n},presetActions:{help:{helpId:function(e,t){var n=e.components.data.get(t).controllerType;return o[n]||"3c9b0528-699b-475f-818c-2123885cb11f"}}},enabledActions:[e.ROOT_COMPS.GFPP.ACTIONS.HELP]};function p(e,t){var n,o,i,a=(n=e,o=t,i=g.get(o,"gfpp."+n+".label"),g.isNil(i)?v:i);return{label:a,shouldTranslate:a===v,onClick:g.partial(r,e)}}function r(e,t,n){var o,i,a,r=g.head(n),p=t.components.data.get(r),s=t.dsRead.platform.controllers.settings.get(r),l=t.dsRead.platform.controllers.getName(r),c=t.platform.controllers.getStageData(g.head(n));t.bi.event(A.CONTROLLER_GFPP_CLICK,{action_name:(o=e,i=c,a=g.get(i,"gfpp."+o+".actionId"),g.isNil(a)?v:a),app_name:p.applicationId,controller_type:p.controllerType,component_id:r.id,pageId:t.pages.getCurrentPageId()});var d=t.dsRead.platform.getAppDataByAppDefId(p.applicationId),u={controllerRef:r,controllerConfig:s,controllerType:p.controllerType,controllerDisplayName:l,origin:"gfpp"},f=void 0;if(e===I.DEPRECATED_MAIN_ACTION)f=P.factory.controllerSettingsButtonClicked(u);else{var m=g.get(c,"gfpp."+e+".actionId");f=P.factory.controllerGfppClicked(g.assign(u,{id:m}))}t.dsActions.platform.notifyApplication(d.applicationId,f)}return{init:function(e){e("AppController",n)}}}),define("platform/services/platformConnectedGfpp",["lodash","gfppData","experiment","constants"],function(d,u,p,e){"use strict";var f=e.ROOT_COMPS.GFPP.ACTIONS,s="DEFAULT",l="HIDE",m=[f.ADD,f.SETTINGS,f.LAYOUT,f.DESIGN,f.UPGRADE,f.CUSTOM_CONNECT],c={desktop:[f.MANAGE,f.BACKGROUND,f.ADD,f.SETTINGS,f.LINK,f.LAYOUT,f.DESIGN,f.CUSTOMIZE_DESIGN,f.APPLY_TO_OTHER_VIEW,f.CROP,f.FILTERS,f.EFFECTS,f.ANIMATION,f.AVIARY,f.STRETCH,f.STRETCH_FOR_COLUMNS,f.UPGRADE,f.HELP,f.CUSTOM_CONNECT,f.CONNECT,f.PIN_MODE],mobile:[f.MANAGE,f.SCALE_UP,f.SCALE_DOWN,f.SETTINGS,f.LAYOUT,f.DESIGN,f.CUSTOMIZE_DESIGN,f.APPLY_TO_OTHER_VIEW,f.CROP,f.FILTERS,f.EFFECTS,f.ANIMATION,f.AVIARY,f.STRETCH,f.UPGRADE,f.HIDE,f.HELP]},g=[f.HELP,f.HIDE],P="advancedStylePanel.multiComponentAdvancedStylePanel";function o(e){return d.has(e,"textSize")?d.assign({},e,{scale_up:e.textSize,scale_down:e.textSize}):d.omit(e,["scale_up","scale_down"])}function A(e,t){return"mobile"===e?p.isOpen("mobileAnimationsSplit")?o(t):(n=o(t),d.has(n,f.ANIMATION)?d(n).omit([f.ANIMATION]).assign(_defineProperty({},f.MOBILE_ANIMATION,n[f.ANIMATION])).value():n):t;var n}function v(e,p,t,n){if(d.isEmpty(e.groupMapping))return o=p,i=e.title,a=t,void o.panelManager.openComponentPanel(P,{selectedComponent:[],groupMapping:{},title:i,keyByComp:{},onPresetChanged:a,shouldTranslate:!1},!0);var o,i,a,r=p.dsRead.platform.controllers.getStageData(n).connections,s=d.pickBy(r,"designMapping"),l=p.dsRead.platform.controllers.connections.getConnectedComponents(n).reduce(function(e,t){var n,o,i=(n=t,o=p.dsRead.platform.controllers.connections.getPrimaryConnection(n),d.get(o,"role")),a=p.dsRead.components.getType(t),r=d.get(s,[i,"designMapping",a]);return r&&(e[t.id]=r),e},{});p.panelManager.openComponentPanel(P,{groupMapping:e.groupMapping,presets:e.presets,title:e.title,presetsTitle:e.presetsTitle,onPresetChanged:t,designMapping:l,customHelpId:e.customHelpId||e.helpId,presetHelpId:e.presetHelpId||e.helpId,shouldTranslate:!1},!0)}return{generateMainActions:function(e,t,n,o){var i=[d.get(t,[e,"mainAction1"]),d.get(t,[e,"mainAction2"])],a="desktop"===e?n.mainActions:n.mobileMainActions,r=d(i).map(function(e,t){return d.isObject(e)?d(e).omit(["actionId"]).assign({onClick:function(){o(e)},shouldTranslate:!1}).value():(n=e)&&n!==s?null:d.get(a,[t]);var n}).compact().value();return"desktop"===e&&d.isEmpty(r)?d.take(n.mainActions,1):r},generateIconButtonsOverride:function(e,t,n,o,i,a){var r=A(e,d.get(t,[e,"iconButtons"])),p=d(r).pickBy(function(e,t){return d.has(e,"actionId")&&d.includes(m,t)}).mapValues(function(e,t){return{isSelected:function(e){return e.panelManager.findPlatformPanelByType(t)},onClick:function(){o(e)}}}).value(),s=d.get(t,[e,"helpId"]);s&&d.set(p,["help","desktop"===e?"helpId":"mobileHelpId"],s);var l=d.get(t,[e,"globalDesign"]);if(l){var c={isSelected:u.utils.getPanelStateFn(P),onClick:function(e){return v(l,e,i,a)}};d.set(p,f.DESIGN,c)}return d.assign({},n.presetActions,p)},generateEnabledActions:function(e,t,n){var o=A(e,d.get(t,[e,"iconButtons"])),i=c[e];if(d.get(t,[e,"globalDesign"])&&n.push(f.DESIGN),d.isEmpty(o))return d.pull(n,f.UPGRADE);var a=d.filter(n,function(e){var t=o[e];return e===f.UPGRADE?p.isOpen("se_platformPremiumGfpp")&&t===s||d.isObject(t):d.includes(g,e)||t!==l}),r=d.filter(i,function(e){var t=d.includes(m,e)&&o[e]&&d.isObject(o[e]),n=d.includes(a,e);return t||n});return d.forEach(m,function(e){if(o[e]&&d.isObject(o[e])&&!d.includes(n,e)){var t=r.indexOf(e);a.splice(t,0,e)}}),a}}}),define("platform/utils/upgradeUtils",["lodash","stateManagement","util"],function(e,o,n){"use strict";var i="https://www.wix.com/apps/upgrade",a="GFPP";function r(e,t){return new n.UrlBuilder(i).param("appDefId",t).param("metaSiteId",e.dsRead.generalInfo.getMetaSiteId()).param("pp_origin",a).url()}return{getPremiumUrl:r,getPremiumGfpp:function(n){return{onClick:function(t){if(t.dsRead.generalInfo.isFirstSave())requirejs(["tpa"],function(e){return e.packagePicker.startUpgradeFlow(t,n,!1,{shouldNavigate:!1})});else{window.open(r(t,n),"_blank");var e=t.dsRead.tpa.app.getDataByAppDefId(n);t.store.dispatch(o.tpa.actions.addAppToTrackForUpgrade(e.applicationId))}}}}}}),define("platform/appController/appWidgetGfpp",["lodash","platformEvents","stateManagement","gfppData","platform/services/platformConnectedGfpp","platform/utils/upgradeUtils"],function(f,m,g,P,A,v){"use strict";var I=g.editorPlugins.components.selectors;function T(n){return n.onClick?f.assign({},n,{onClick:function(e,t){n.onClick(e,e.components.getChildren(t))}}):n}function t(n,e){var o=f.head(e),t=n.components.getChildren(o),i=_slicedToArray(t,1)[0],a=I.getCompTypeSuffix([i],n.dsRead),r=P.utils.getGfppDataResolver(n,e),p=f.cloneDeep(r(P.getComponentData(a)));p.presetActions=f.mapValues(p.presetActions,T),p.mainActions=f.map(p.mainActions,T);var s=f.get(n.platform.controllers.getStageData(o),"gfpp");if(s){var l=g.editorPlugins.mobile.selectors.getDeviceType(n.store.getState()),c=n.components.data.get(o).applicationId,d=n.platform.getAppDataByAppDefId(c).applicationId,u=function(e){var t=e.actionId;n.platform.notifyApplication(d,m.factory.widgetGfppClicked({id:t,componentRef:o}))};p.presetActions=p.presetActions||{},p.presetActions.upgrade=v.getPremiumGfpp(c),"desktop"===l?(p.enabledActions=p.enabledActions||[],p.enabledActions.push("upgrade"),p.mainActions=A.generateMainActions(l,s,p,u),p.enabledActions=A.generateEnabledActions(l,s,r(p.enabledActions))):(p.mobileMainActions=A.generateMainActions(l,s,p,u),p.mobileEnabledActions=A.generateEnabledActions(l,s,r(p.mobileEnabledActions))),p.presetActionsData=A.generateIconButtonsOverride(l,s,p,u,function(e){n.platform.notifyApplication(d,m.factory.globalDesignPresetChanged({preset:e,componentRef:o}))},o)}return p}return{init:function(e){e("AppWidget",t)}}}),define("platform/appController/appController",["lodash","platform/appController/controllerSettingsGfpp","platform/appController/appWidgetGfpp","platform/bi/events.json"],function(p,n,o,i){"use strict";function s(o,e){var i=p.reduce(e,function(e,t){return o.components.is.container(t)?e.concat(t,o.components.get.byAncestor(t)):e.concat(t)},[]),a=void 0;return p.some(i,function(e){var t,n=o.dsRead.platform.controllers.connections.get(e);return!p.isEmpty(n)&&(t=n,a=a||p.keyBy(i,"id"),p(t).map("controllerRef").some(function(e){var t=e.id;return!a[t]&&o.components.getPage(e).id!==o.pages.getMasterPageId()}))})}function a(t,e,n){e=p.isArray(e)?e:[e];var o,i=t.components.isShowOnAllPages(e),a=t.components.isShowOnAllPages(n);function r(e){t.panelManager.openPanel("platform.panels.warnForDisconnectedComponentsPanel",p.assign({undo:t.history.undo},e))}i&&!a&&(o=t,p(e).reduce(function(e,t){return o.components.is.container(t)?e.concat(t,o.components.get.byAncestor(t)):e.concat(t)},[]).some(function(e){return"platform.components.AppController"===o.components.getType(e)}))&&r({controllerComp:!0}),!i&&a&&s(t,e)&&r({connectedComps:!0})}return{init:function(e,t){return n.init(t),o.init(t),e.registerCannotRemovePlugin("platform.components.AppController",function(e,t){var n=e.components.data.get(t);e.bi.event(i.page_delete_dataset,{app_name:n.applicationId,controller_type:n.controllerType,controller_id:t.id,pageId:e.dsRead.pages.getPrimaryPageId()})}.bind(null,e)),e.editorEventRegistry.register(e.editorEventRegistry.constants.events.SET_CONTAINER_BEFORE,a),this}}}),define("platform/connection/connection",["lodash","coreUtilsLib","platform/common/constants","stateManagement"],function(p,s,l,a){"use strict";var n=a.editorPlugins.platform.selectors.isConnectedToDataBindingController;function o(e,t){return n(p.head(t),e.dsRead)}var t={connect:{isSelected:function(e){return e.panelManager.findPlatformPanelByType("connect")},isApplied:o,tooltip:"gfpp_component_connect",tooltip_active:"gfpp_component_connected_to_controllers",icon:"connect",rightClickMenuLabel:"PLATFORM_RightClick_Menu_Connect",className:function(e,t){return["gfpp_component_connect",o(e,t)?"connected":""].join(" ")},onClick:e,isSupported:function(e,t){return o=(n=e).dsRead.platform.editorApps.DATA_BINDING.appDefId,i=n.store.getState(),p.get(a.editorPlugins.appsStore.selectors.getAppStore(i,o),"dataMode",!1)&&e.components.is.allowConnectToDB(t)&&!e.isMobileEditor();var n,o,i}}};function e(e,t){var n=e.dsRead.platform.getInstalledAppsData(),o=1===n.length?p.head(n):"multiple application ids provided - TODO",i=p.head(t),a=l.EVENTS.componentConnectButtonClicked,r={componentRef:i,componentType:e.components.getType(i),componentSdkType:e.wixCode.getCompSdkType(i),origin:"gfpp"};e.dsActions.platform.notifyApplication(o.applicationId,{eventType:a,eventPayload:s.objectUtils.cloneDeep(r)})}return{init:function(e){return e(t),this},notifyConnectButtonClicked:e}}),define("platform/common/utils",["lodash","constants","util"],function(r,e,p){"use strict";function s(e,t,n){var o=p.url.setUrlParam(e,"applicationId",t),i=p.url.setUrlParam(o,"appDefinitionId",n),a=l();return r.isEmpty(a)?i:p.url.setUrlParam(i,"extraNamespaces",r.join(a,","))}function l(){return p.appStudioUtils.isAppStudio()?e.APP_STUDIO.PLATFORM_EXTRA_NAMESPACES:[]}return{getExtraNamespaces:l,getFullApplicationUrl:function(o,e,t,n){var i=r.chain(window.location.search.substr(1)).thru(p.url.parseUrlParams).get("editorPlatformAppSources","").split(",").invokeMap("split",":").fromPairs().value();if(r.startsWith(e,"http"))return s(e,n,t);var a=function(e){var t=r.get(o,"appFields.platform.editorScriptUrl");if(t)return t;var n=r.get(o,"editorArtifact");return n?e?p.url.joinURL(p.serviceTopology.scriptsDomainUrl,"services",n,e):p.serviceTopology.scriptsLocationMap[n]:void 0}(i[t]);return a?s(new URL(e,a).href,n,t):void 0}}}),define("platform/services/tokenService",["lodash"],function(t){"use strict";return{generatePanelToken:function(e){return t.uniqueId("platform_"+e+"_")},generateStaticGlobalPanelToken:function(e){return t.uniqueId("platform_"+e)}}}),define("platform/api/editor/utils/utils",["util"],function(i){"use strict";return{getLinkAsString:function(e,t,n,o){return i.link.getLinkValueAsString(e,o.link)}}}),define("platform/api/document/document",[],function(){"use strict";return{save:function(n){return new Promise(function(e,t){n.saveManager.saveInBackground(function(){e()},t)})}}}),define("platform/api/editor/editor",["lodash","zepto","pmrpc","constants","platform/common/constants","platform/common/utils","platform/services/tokenService","platform/api/editor/utils/utils","platform/api/document/document","stateManagement","experiment","util"],function(l,r,n,s,c,a,p,e,t,d,u,f){"use strict";var o=d.editorPlugins.panels.actions,m=o.openPlatformPanel,i=o.updateOrOpenPanel,g={IMAGE:function(e){return{uri:e.uri,title:e.title,width:e.width,height:e.height}},DOCUMENT:function(e){return{uri:e.uri,title:e.title}},DEFAULT:function(e){return e}};function P(e,t){t=t||{};var n=e.panelManager.getOpenPanels(),o=l.find(n,{type:"platform"});if(o){var i=r('[name="'+o.token+'"]');if(i){var a=i.offset();if(a&&l.isNumber(a.top)&&l.isNumber(a.left)){if(l.isNumber(t.x)&&l.isNumber(t.y))return{top:a.top+t.y,left:a.left+t.x};if(l.isNumber(t.height)&&l.get(o,"props.height")&&l.get(o,"props.width"))return{top:a.top+o.props.height/2-t.height/2,left:a.left+o.props.width/2}}}}return{top:"25%",left:"45%"}}function A(e,t,n){var o=e.dsRead.platform.getAppDataByApplicationId(t.applicationId),i=l.assign({token:p.generatePanelToken(o.appDefinitionId)},n);return n.url&&l.assign(i,{url:a.getFullApplicationUrl(o,n.url,o.appDefinitionId,o.applicationId)}),u.isOpen("se_multilingual")&&u.isOpen("se_multilingualHideOnboardingPanel")&&l.assign(i,{appDefinitionId:o.appDefinitionId,instanceId:o.instanceId}),i}return{openPanel:function(e,t,n,o,i){e.panelManager.openPanel(n,o,i)},_OpenSiteMembersSettingsPanel:function(e,t,n){e.store.dispatch(i("panels.focusPanels.siteMembersSettingsPanel",n,!0))},openComponentPanel:function(t,e,n,o){var i=A(t,e,o);return t.selection.selectComponentByCompRef(o.componentRef),new Promise(function(e){t.store.dispatch(m({panelName:c.panelTypes.COMPONENT_PANEL,panelProps:i,panelMetaData:{resolve:e,frameType:s.PANEL_TYPES.COMP,closeAllOtherPanels:!0}}))})},openModalPanel:function(t,e,n,o){var i=A(t,e,o);return new Promise(function(e){t.store.dispatch(m({panelName:c.panelTypes.MODAL,panelProps:i,panelMetaData:{resolve:e}}))})},openToolPanel:function(t,e,n,o){var i=A(t,e,o),a=c.panelTypes.TOOL,r=P(t,o);return l.merge(i,r),new Promise(function(e){t.store.dispatch(m({panelName:a,panelProps:i,panelMetaData:{resolve:e}}))})},openPagePanel:function(e,t,n,o){var i=o.pageRef.id,a=l.get(o,"renameEnabled")||!1,r=e.pages.dynamicPages.getDynamicPageActions(i,"pageSettings"),p=l.isEmpty(r)?{initialSettingsTabType:s.PAGE_SETTINGS_TABS.PAGE_INFO,renameEnabled:a}:{initialSettingsTabType:l.head(r).type,renameEnabled:a};e.navigateAndOpenPagesPanel(i,p)},openPagesPanel:function(i,e,t,a){return new Promise(function(e,t){var n=a.pageRef.id;if(i.pages.doesPageExist(n)){var o={renameEnabled:l.get(a,"renameEnabled"),initialSettingsTabType:l.get(a,"initialSettingsTabType")};i.navigateAndOpenPagesPanel(n,o,e)}else t("PageRef does not exist")})},openFullStagePanel:function(e,t,n,o){var i=A(e,t,o);e.store.dispatch(m({panelName:c.panelTypes.FULL_STAGE,panelProps:i,panelMetaData:{frameType:s.PANEL_TYPES.FULL_STAGE,closeAllOtherPanels:!0}}))},openLinkPanel:function(n,e,t,o){return new Promise(function(e){var t={link:l.get(o,"value",null),visibleSections:l.get(o,"visibleSections",null),callback:e,hideLinkTarget:!0,onCancelCallback:e};n.openLinkPanel(t)})},openSidePanel:function(t,e,n,o){var i=A(t,e,o);return new Promise(function(e){t.store.dispatch(m({panelName:c.panelTypes.DOCKED,panelProps:i,panelMetaData:{resolve:e,closeWithUserIntent:!0,frameType:s.PANEL_TYPES.DOCKED_PANEL}}))})},openColorPicker:function(i,e,t,n,a){var o=Object.assign({},{position:{x:-12,y:72},color:"#FFFFFF"},n),r=void 0,p=new Promise(function(e){r=e});return i.panelManager.openPanel("panels.toolPanels.colorPicker.colorPickerPanel",l.merge({value:o.color,onChange:function(e){var t=null,n=null,o=i.theme.colors.getAll();n=e.includes("color_")?(t=o[e],e):(t=e,Object.keys(o).find(function(e){return o[e]===t})),a({color:t,theme:n,isHover:!1})},onClose:r,enableHistory:!1,palettePresets:i.theme.colors.getColorPresets(),updateSitePalette:function(e){return i.theme.colors.update(e)},previewOnHover:!1},P(i,o.position)),!0),p},openMediaPanel:function(i,e,t,a){return a=l.defaults(a||{},{callOnCancel:!0,isMultiSelect:!0,mediaType:"IMAGE"}),new Promise(function(o){i.mediaServices.mediaManager.open(a.mediaType,{multiSelect:a.isMultiSelect,callback:function(e){var t=void 0;if(l.isEmpty(e))a.callOnCancel&&(t=null);else{l.isArray(e)||(e=[e]);var n=l.get(g,a.mediaType,g.DEFAULT);t=e.map(n)}o(t),i.mediaServices.setFocusToEditor()}})})},openHelpPanel:function(e,t,n,o){var i={component:e.selection.getSelectedComponentType(),learn_more:!1,panel_name:"platform"};e.panelManager.openHelpCenter(o.helpId,{origin:"platform"},i)},updatePanelOptions:function(e,t,n,o){var i,a,r=(i=e,a=n,l.find(i.panelManager.getOpenPanels(),{token:a}));if(r){var p=A(e,t,o);p.token=n,e.panelManager.updatePanelProps(r.name,p)}},closePanel:function(e,t,n,o){e.store.dispatch(d.editorPlugins.panels.actions.closePlatformPanel(n,o))},setAppAPI:function(e,t){return n.api.request(t.applicationId,{target:e.dsRead.platform.getAppsContainer()}).then(function(e){n.api.set(t.applicationId,e)})},save:t.save,utils:e,showNotification:function(n,e,t,o){var i=o.title,a=o.message,r=o.type,p=o.link;return"old"===u.getValue("se_notificationCenter")?new Promise(function(e){var t={name:"platform.platformNotification",onClose:function(){return e()},title:i,message:a,type:r,id:l.uniqueId("notification-")};p&&p.caption&&(t.linkAction={caption:p.caption,onClick:function(){return e(!0)}}),n.store.dispatch(d.editorPlugins.notifications.actions.addNotification(t))}):l.findKey(n.store.getState().notifications,["message",a])?void 0:new Promise(function(e){var t={name:"notifications.editorNotification",onClose:function(){return e()},title:i,message:a,type:r,id:l.uniqueId("notification-"),shouldTranslate:!1};p&&p.caption&&(t.linkAction={caption:p.caption,onClick:function(){return e(!0)}}),n.store.dispatch(d.editorPlugins.notifications.actions.showTPAUserActionNotification(t))})},showUserActionNotification:function(n,e,t,o){var i=o.title,a=o.message,r=o.type,p=o.link;return"old"===u.getValue("se_notificationCenter")?new Promise(function(e){var t={name:"platform.platformNotification",onClose:e,title:i,message:a,type:r,id:l.uniqueId("notification-")};p&&p.caption&&(t.linkAction={caption:p.caption,onClick:function(){return e(!0)}}),n.store.dispatch(d.editorPlugins.notifications.actions.addNotification(t))}):l.findKey(n.store.getState().notifications,["message",a])?void 0:new Promise(function(e){var t={name:"notifications.editorNotification",onClose:function(){return e()},title:i,message:a,type:r,id:l.uniqueId("notification-"),shouldTranslate:!1};p&&p.caption&&(t.linkAction={caption:p.caption,onClick:function(){return e(!0)}}),n.store.dispatch(d.editorPlugins.notifications.actions.showTPAUserActionNotification(t))})},openBillingPage:function(n,e,t){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=o.premiumIntent,a=o.referrer,r=n.dsRead.platform.getAppDataByApplicationId(e.applicationId).appDefinitionId;return new Promise(function(t){requirejs(["tpa"],function(e){e.packagePicker.startUpgradeFlow(n,r,!0,{premiumIntent:i,origin:a,shouldNavigate:!1}),t()})})},updateAppState:function(e,t,n){var o=e.dsRead.platform.getAppDataByApplicationId(t.applicationId).appDefinitionId;e.store.dispatch(d.editorPlugins.appsStore.actions.updateAppsStore(o,n))},openDashboardPanel:function(n,o,e){var t=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},i=t.closeOtherPanels,a=t.url,r=f.serviceTopology.businessManagerUrl,p=n.dsRead.generalInfo.getMetaSiteId(),s=f.url.joinURL(r,p,a);return new Promise(function(e){var t=l.merge({},{url:f.url.setUrlParam(s,"viewMode","editor"),onClose:function(){return e()},isBareMode:!0,width:"100%",height:"100%"},A(n,o,{}));n.store.dispatch(m({panelName:c.panelTypes.DASHBOARD,panelProps:t,panelMetaData:{resolve:e,closeAllOtherPanels:i}}))})}}}),define("platform/api/editor/preview/preview",[],function(){"use strict";return{navigateTo:function(t,e,n,o){return new Promise(function(e){t.dsActions.platform.pages.navigateTo(o.pageUrl,function(){t.preview.isInPreviewMode()?e():t.preview.togglePreview(e)})})}}}),define("platform/api/document/vfs/vfs",["lodash"],function(r){"use strict";function p(e){return{name:e.name,fullPath:e.location,isDirectory:e.directory}}return{listChildren:function(e,t,n,o){var i=e.wixCode.fileSystem,a=i.getVirtualDescriptor(o.path,!0);return i.getChildren(a).then(function(e){return r.map(e,p)})},readFile:function(e,t,n,o){var i=e.wixCode.fileSystem,a=i.getVirtualDescriptor(o.path,!1);return i.readFile(a)},writeFile:function(e,t,n,o){var i=e.wixCode.fileSystem,a=i.getVirtualDescriptor(o.path,!1);return i.writeFile(a,o.content)},deleteFile:function(e,t,n,o){var i=e.wixCode.fileSystem,a=i.getVirtualDescriptor(o.path,!1);return i.deleteItem(a)},flush:function(e){return e.wixCode.fileSystem.flush()}}}),define("platform/api/document/pages/pages",["lodash","util"],function(p,r){"use strict";return{navigateTo:function(t,e,n,o){var i=p.get(o,"pageRef.id"),a=p.get(o,"pageLink"),r=i||a;if(r)return new Promise(function(e){t.pages.navigateTo(r,function(){e()})})},rename:function(e,t,n,o){var i=o.pageRef.id,a=r.validate.pageNameValidator(o.title);return a||e.pages.data.update(i,{title:o.title}),a},add:function(n,e,t,o){return new Promise(function(e){var t=n.pages.add(o.title,o.definition,o.shouldAddMenuItem);n.pages.navigateTo(t.id,function(){e(t)})})},remove:function(a,r,e,p){return new Promise(function(e,t){var n=r.appDefinitionId,o=p.pageRef,i=a.dsRead.pages.data.get(o.id);return i?n!==i.managingAppDefId?t("page with id '"+o.id+"' can not be deleted. page is not managed by this application"):a.dsRead.viewMode.get()===a.dsRead.viewMode.VIEW_MODES.MOBILE?t("page with id '"+o.id+"' can not be deleted. deletion is not allowed in mobile view"):void a.pages.remove(o.id,e,function(){return t("removed canceled")}):t("page with id '"+o.id+"' doesn't exist")})},data:{update:function(e,t,n,o){var i=o.pageRef.id;e.pages.data.update(i,o.data)}}}}),define("platform/api/document/components/components",["lodash"],function(c){"use strict";return{add:function(s,e,t,l){return new Promise(function(e,t){c.isEmpty(l.componentDefinition.componentType)&&t(new Error("componentDefinition must contain componentType"));var n,o,i,a,r,p=s.components.buildDefaultComponentStructure(l.componentDefinition.componentType);n=s,o=p,i=l,a=c.get(i,"pageRef.id")||n.dsRead.pages.getFocusedPageId(),r=n.pasteLogic.addContext.getPastePosition(n,o.layout,a),c.merge(o.layout,r),c.merge(p,l.componentDefinition),e(s.components.add(l.pageRef,p,l.customId,void 0,"editorSdk",{showAddToHeaderPanel:l.showAddToHeaderPanel,optionalIndex:l.optionalIndex}))})},getPage:function(e,t,n,o){return e.components.getPage(o.componentRef)},properties:{get:function(e,t,n,o){return e.components.properties.get(o.componentRef)},update:function(e,t,n,o){e.components.properties.update(o.componentRef,o.props,o.dontAddToUndoRedoStack)}},data:{get:function(e,t,n,o){return e.components.data.get(o.componentRef)},update:function(e,t,n,o){e.components.data.update(o.componentRef,o.data,!0)}},layout:{get:function(e,t,n,o){return e.components.layout.get(o.componentRef)}}}}),define("platform/api/document/routers/routers",["lodash","util"],function(p,s){"use strict";return{isValidPrefix:function(e,t,n,o){var i=p.get(t,"applicationId"),a=e.dsRead.routers.isValidPrefix(i,o.prefix);if(!a.valid){var r="";switch(a.message){case 1:r="DYNAMIC_PAGES_VALIDATION_PREFIX_CAN_NOT_BE_EMPTY";break;case 2:r="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_TOO_LONG";break;case 3:r="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_DUPLICATE_OF_URISEO";break;case 4:r="DYNAMIC_PAGES_VALIDATION_PREFIX_CONTAINS_INVALID_CHARCTERS";break;case 5:r="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_FORBIDDEN_WORD";break;case 6:r="DYNAMIC_PAGES_VALIDATION_PREFIX_IS_IN_USE_BY_ANOTHER_APPLICATION"}a.message=s.translate(r)}return a},pages:{delete:function(i,a,e,r){return new Promise(function(e,t){var n=p.get(i.dsRead.platform.getAppDataByApplicationId(a.applicationId),"appDefinitionId"),o=i.dsRead.routers.get.byRef(r.routerRef);o&&o.appDefinitionId===n?i.pages.remove(r.pageRef.id,function(){e()},function(){t()},!1):t()})}}}}),define("platform/api/document/history/history",[],function(){"use strict";return{add:function(t,e,n,o){return new Promise(function(e){t.dsActions.waitForChangesApplied(function(){t.history.add(o.label,null,o.historySnapshotId),e()})})}}}),define("platform/api/editor/ide/ide",["lodash"],function(l){"use strict";function c(e,t,n,o){return e.wixCode.collectionsTree.navigateToCollection(e,o.name)}return{openFile:function(e,t,n,o){var i,a,r,p=o.path,s=e.wixCode.fileSystem.getRoots().schemas.location;return a=s,r=p,l.startsWith(r,a)&&l.endsWith(r,".json")?c(e,0,0,{name:(i=s,o.path.replace(i,"").replace(".json",""))}):e.wixCode.fileTree.navigateToFile(e,o.path,l.pick(o,["functionName","caretOffset","caretLocation"]))},navigateToCollection:c,treePane:{isOpen:function(e){return e.developerMode.ui.treePane.isOpen()},toggle:function(t){return new Promise(function(e){t.developerMode.ui.treePane.toggle(function(){e()})})}}}}),define("platform/api/extraNamespaces/appBuilder/appBuilder",["lodash","stateManagement"],function(e,n){"use strict";return{getAppName:function(e){var t=e.store;return n.applicationStudio.selectors.getAppName(t.getState())},getAppNamespace:function(e){var t=e.store;return n.applicationStudio.selectors.getNamespace(t.getState())}}}),define("platform/api/extraNamespaces/extraNamespaces",["lodash","platform/common/utils","platform/api/extraNamespaces/appBuilder/appBuilder"],function(e,t,n){"use strict";var o={appBuilder:n};return e.pick(o,t.getExtraNamespaces())}),define("platform/api/editor/info/info",["lodash","stateManagement","util"],function(c,e,a){"use strict";var n=e.editorPlugins.leftBar.selectors.getDeviceType;var t=window.mainLoaded||0;function d(){var e=window.location.hostname.match(/editor\.(.*)/);return e?"www."+e[1]:"www.wix.com"}function u(e){return!e.dsRead.generalInfo.isFirstSave()}return{getDashboardUrl:function(p,s,e,l){return new Promise(function(o,i){var e=c.get(l,"appDefinitionId"),a=e||c.get(p.dsRead.platform.getAppDataByApplicationId(s.applicationId),"appDefinitionId"),r=e?c.get(p.dsRead.platform.getAppDataByAppDefId(a),"applicationId"):s.applicationId,t=u(p),n=function(){var e,t,n;a===p.dsRead.platform.editorApps.DATA_BINDING.appDefId?o((n=p,["//",d(),"/my-account/sites/",n.dsRead.generalInfo.getMetaSiteId(),"/simple-app","?app=wixcode","&referralInfo=editor_platform"].join(""))):p.dsRead.tpa.app.isHybrid(r)||p.dsRead.tpa.app.isDashboardAppOnly(r)?o((e=p,t=a,["//",d(),"/my-account/sites/",e.dsRead.generalInfo.getMetaSiteId(),"/app/",t,"?referralInfo=editor"].join(""))):i("The given appDefinitionId does not have an dashboard URL.")};t?n():p.saveManager.saveInBackground(function(){n()},i)})},getBusinessManagerUrl:function(e){if(!u(e))throw new Error("Site has never been saved");var t=a.serviceTopology.businessManagerUrl,n=e.dsRead.generalInfo.getMetaSiteId();return a.url.joinURL(t,n)},getMetaSiteId:function(e){return e.dsRead.generalInfo.getMetaSiteId()},getEditorSessionId:function(){return a.editorSessionUtil.editorSessionId},getEditorUrlQueryParamByName:function(e,t,n,o){var i=o.paramName;return a.url.getParameterByName(i)},getSiteId:function(e){return e.dsRead.generalInfo.getSiteId()},getEditorReadyTimestamp:function(){return c.now()-t},getEditorMode:function(e){var t=e.store.getState();return n(t)},getAppDefinitionId:function(e,t){var n=t.applicationId;return e.dsRead.platform.getAppDataByApplicationId(n).appDefinitionId},isSitePublished:function(e){return e.dsRead.generalInfo.isSitePublished()},getLanguage:function(e){return e.dsRead.generalInfo.getLanguage()},isSiteSaved:u}}),define("platform/api/editor/application/application",[],function(){"use strict";return{appStudioWidgets:{changeVariation:function(t,e,n,o){var i=o.componentRef,a=o.variationId;return new Promise(function(e){t.selection.deselectComponents(),t.dsActions.appStudioWidgets.changeVariation(i,a,e),t.history.add("change variation")})}}}}),define("platform/api/editor/environment/environment",["util"],function(e){"use strict";return{getLocale:function(){return e.editorModel.languageCode}}}),define("platform/api/editor/userPreferences/userPreferences",["lodash","coreUtilsLib","stateManagement"],function(s,l,c){"use strict";return{site:{set:function(i,e,t,a){return new Promise(function(t,n){var o=s.get(i.dsRead.platform.getAppDataByApplicationId(e.applicationId),"appDefinitionId");o||n(new Error("Illegal appData - application is not registered in clientSpecMap")),i.store.dispatch(c.editorPlugins.userPreferences.actions.registerSitePreferencesCallbacks(function(e){e||n(new Error("Site Preferences failed to load")),s.forEach(a,function(e,t){i.store.dispatch(c.editorPlugins.userPreferences.actions.setSiteUserPreferences(t,e,o))}),t()}))})},get:function(r,e,t,p){return new Promise(function(n,o){var i=s.get(r.dsRead.platform.getAppDataByApplicationId(e.applicationId),"appDefinitionId");i||o(new Error("Illegal appData - application is not registered in clientSpecMap"));var a=s.isArray(p)?s(p).keyBy().mapValues(s.noop).value():p;r.store.dispatch(c.editorPlugins.userPreferences.actions.registerSitePreferencesCallbacks(function(e){e||o(new Error("Site Preferences failed to load"));var t=s.mapValues(a,function(e,t){return l.objectUtils.cloneDeep(c.editorPlugins.userPreferences.selectors.getSiteUserPreferences(t,i)(r.store.getState()))});n(s.defaults(t,a))}))})}}}}),define("platform/api/document/tpa/tpa",["lodash"],function(p){"use strict";return{add:{application:function(e,t,n,o){return new Promise(function(t,n){p.get(o,"appDefinitionId")?e.tpa.addApplication(o.appDefinitionId,o).then(function(e){t(e)}).catch(function(e){n(e)}):n(new Error("options must contain appDefinitionId"))})},component:function(e,o,t,i){return new Promise(function(t,n){if((i=i||{}).componentType){if(i.appDefinitionId||(i.appDefinitionId=o.appDefinitionId),"WIDGET"===i.componentType){if(!p.isObject(i.widget))return void n(new Error("options must contain a widget object"));i.widget.tpaWidgetId=i.widget.widgetId}else if("PAGE"===i.componentType){if(!p.isObject(i.page))return void n(new Error("options must contain a page object"));if(i.page.isHidden&&!p.isBoolean(i.page.isHidden))return void n(new Error("isHidden param should be of type boolean"))}e.tpa.addComponent(i).then(function(e){t(e)}).catch(function(e){n(e)})}else n(new Error("options must contain componentType"))})}},isApplicationInstalled:function(n,e,t,o){return new Promise(function(e,t){p.get(o,"appDefinitionId")?e(n.dsRead.tpa.app.isInstalled(o.appDefinitionId)):t(new Error("options must contain appDefinitionId"))})},isAppSectionInstalled:function(i,a,e,r){return new Promise(function(e,t){if(p.get(r,"sectionId")){var n=a.applicationId;if(r.appDefinitionId){var o=i.dsRead.tpa.app.getDataByAppDefId(r.appDefinitionId);n=p.get(o,"applicationId")}e(i.dsRead.tpa.section.isSectionInstalledByTpaPageId(n,r.sectionId))}else t(new Error("options must contain sectionId"))})}}}),define("platform/api/document/application/application",["lodash","util","platform/common/constants"],function(l,c,d){"use strict";return{install:function(r,p,e,s){return c.fedopsLogger.interactionStarted(c.fedopsLogger.INTERACTIONS.INSTALL_APP),new Promise(function(t,n){var o=l.get(s,"appDefinitionId");if(o)if(o!==r.platform.editorApps.WIX_CODE.appDefId){var e=r.tpa.bi.consts.APP.TYPE.PLATFORM_ONLY,i=r.tpa.bi.consts.BI.initiator.PLATFORM,a={initiator:d.ORIGIN.INITIATOR.APP,info:{appDefinitionId:l.get(p,"appDefinitionId")}};r.tpa.services.tpaAddAppService.addApp(r,s.appDefinitionId,null,null,e,i,!1,{},{},function(e){l.get(e,"success")?(c.fedopsLogger.interactionStarted(c.fedopsLogger.INTERACTIONS.INSTALL_APP),t(e)):(c.ravenUtils.captureError(e,{tags:{appInstallFailed:o},extra:{appData:p,options:s}}),n(e))},a)}else r.wixCode.provision({onSuccess:t,onError:n});else n(new Error("options must contain appDefinitionId"))})}}}),define("platform/api/internalAPIs",["lodash"],function(o){"use strict";return{addApp:function(e,t,n){e.wixCode.provision(o.noop,o.noop),e.dsActions.platform.initApp({appDefinitionId:o.get(n,"appDefinitionId"),editorUrl:o.get(n,"editorUrl"),viewerUrl:o.get(n,"viewerUrl")})}}}),define("platform/api/editor/selection/selection",["lodash","stateManagement"],function(i,a){"use strict";return{getSelectedComponents:function(e){return e.selection.getSelectedComponents()},deselectComponents:function(e,t,n,o){e.selection.deselectComponents(i.get(o,"compsToDeselect",[]))},selectComponentByCompRef:function(e,t,n,o){e.selection.selectComponentByCompRef(i.get(o,"compsToSelect",[]))},locateAndHighlightComponentByCompRef:function(e,t,n,o){e.store.dispatch(a.componentLocator.actions.locateComponentAndHighlight(o.compRef,!1))},clearHighlights:function(e){e.store.dispatch(a.editorPlugins.highlights.actions.clearOverlayHighlights())}}}),define("platform/api/editor/developerMode/developerMode",[],function(){"use strict";return{isEnabled:function(e){return e.developerMode.isEnabled()}}}),define("platform/api/api",["lodash","platform/api/editor/editor","platform/api/document/document","platform/api/editor/preview/preview","platform/api/document/vfs/vfs","platform/api/document/pages/pages","platform/api/document/components/components","platform/api/document/routers/routers","platform/api/document/history/history","platform/api/editor/ide/ide","platform/api/extraNamespaces/extraNamespaces","platform/api/editor/info/info","platform/api/editor/application/application","platform/api/editor/environment/environment","platform/api/editor/userPreferences/userPreferences","platform/api/document/tpa/tpa","platform/api/document/application/application","platform/api/internalAPIs","platform/api/editor/selection/selection","platform/api/editor/developerMode/developerMode"],function(e,t,n,o,i,a,r,p,s,l,c,d,u,f,m,g,P,A,v,I){"use strict";var T={document:e.assign(n,{application:P,components:r,history:s,pages:a,routers:p,tpa:g,vfs:i}),editor:e.assign(t,{environment:f,ide:l,info:d,application:u,__internal__:A,preview:o,selection:v,userPreferences:m,developerMode:I})};return e.merge(T,T.document,T.editor,c)}),define("platform/services/platformPostMessageService",["lodash","pmrpc","coreUtilsLib","platformEvents","platform/common/constants"],function(r,o,p,s,l){"use strict";return{init:function(e,t){o.api.set(l.EDITOR_API_NS,t)},createPostMessageListener:function(i,a){return function(e){if(e.data.intent===l.PLATFORM_PANEL&&e.data.sourcePanel===a)switch(e.data.type){case l.PLATFORM_SDK_READY:t=e.source,n={intent:l.PLATFORM_ON_EVENT,event:s.factory.startConfiguration(i)},r.isUndefined(t)||(n.event.eventPayload=p.objectUtils.cloneDeep(n.event.eventPayload),t.postMessage||(t=t.contentWindow),t.postMessage(n,o||"*"));break;default:return}var t,n,o}},onSetAppPublicAPI:function(e,t){var n=t.apiName;return o.api.request(n,{target:e.dsRead.platform.getAppsContainer()}).then(function(e){o.api.set(n,e)})}}}),define("platform/services/platformWorkerService",["host-worker-init"],function(e){"use strict";var o=e.workerMessagesService;return{createWorkerMessagesAPI:function(){return fetch("https://76897fda-d78f-49dd-bd02-bf9ad52a4f11.dev.wix-code.com/_partials/santa/1.4316.0/node_modules/santa-wix-code/dist/wixcode-worker.js").then(function(e){return new Response(e.body)}).then(function(e){return e.blob()}).then(function(e){return URL.createObjectURL(e)}).then(function(e){var t={sdkSource:"https://static.parastorage.com/services/js-wixcode-sdk/1.242.0/lib/wix.js",namespacesSdkSource:"https://static.parastorage.com/services/wixcode-namespaces/1.3.0/wixcode-namespaces.js",externalComponentsSource:"https://rawgit.com/yotamsha/statics/31a1ae3a8f2688ada5a63ea387dfec9a61d4268c/wixcode-components.min.js",workerProps:{workerUrl:e}},n=o.getAPI();return n.init(t),n})}}}),define("platform/services/flowPlatformApps",["lodash","util","coreUtilsLib"],function(i,a,e){"use strict";var r="flowAppDefId",p="flowAppParams";return{runFlowPlatformApps:function(t){var n=a.url.getParameterByName(r),o=a.url.getParameterByName(p);try{o&&(o=JSON.parse(o))}catch(e){console.error("Failed to parse flowAppParams. expected a JSON format.",e)}if(n)return function(){var e=a.url.parseUrl(window.location.href),t=e.path,n=e.query,o=a.url.baseUrl(window.location.href);delete n[r],delete n[p];var i=a.url.setUrlParams(""+o+t,n);a.windowInteractionUtils.replaceState({},"",i)}(),e.requestsUtil.fetchJson("https://dev.wix.com/_api/app-service/v1/apps/"+n).then(function(e){t.dsActions.platform.initApp({appDefinitionId:n,appFields:{platform:{editorScriptUrl:i.get(e,"components[0].compData.platformComponentData.editorScriptUrl")}}},o)})}}}),define("platform/plugins/componentsRemoveHandlerPlugins",["lodash","stateManagement"],function(p,s){"use strict";return{confirmOnOrphanConnections:function(e,t,n,o,i){if(function(t,e,n){var o=(n=p(n)).filter(function(e){return"platform.components.AppController"===t.components.getType(e)});if(o.isEmpty())return!1;var i=n.map("id").value();return o.map(function(e){return t.platform.controllers.connections.getConnectedComponents(e)}).some(function(e){return!p(e).map("id").difference(i).isEmpty()})}(t,0,o)){var a=p.filter(o,function(e){return"platform.components.AppController"===t.components.getType(e)}),r=1===a.length;return e(s.editorPlugins.panels.actions.updateOrOpenPanel("platform.panels.appControllerDeleteConfirmationPanel",{onConfirm:i,isSingleController:r,controllerDisplayName:r?t.platform.controllers.getName(a[0]):""})),!0}return!1}}}),define("platform/panels/appControllerDeleteConfirmationPanel.rt",["react","lodash","panels","baseUI"],function(e,t,n,o){"use strict";return function(){return e.createElement(n.frames.confirmationPanelFrame,{type:"important",panelName:"platform.panels.appControllerDeleteConfirmationPanel",onConfirm:this.props.onConfirm,confirmLabel:"PLATFORM_messages_delete",cancelLabel:"PLATFORM_messages_cancel_delete",panelTitle:this.getTitle()},e.createElement("div",{className:"icon"},e.createElement(o.symbol,{name:"deleteBlogConfirmationIcon"})),e.createElement("div",{className:"content"},e.createElement("p",{},this.getContentText())))}}),define("platform/panels/appControllerDeleteConfirmationPanel",["create-react-class","prop-types","core","util","platform/panels/appControllerDeleteConfirmationPanel.rt"],function(e,t,n,o,i){"use strict";return e({displayName:"appControllerDeleteConfirmationPanel",propTypes:{controllerDisplayName:t.string,isSingleController:t.bool,onConfirm:t.func},mixins:[o.translationMixin,n.mixins.editorAPIMixin],getContentText:function(){var e=this.props.isSingleController?"PLATFORM_messages_delete_dataset_text":"PLATFORM_messages_multidelete_dataset_text";return this.translateTemplate(e,{appName:"Wix Database"},this.getEditorAPI())},getTitle:function(){var e=this.props.isSingleController?"PLATFORM_messages_delete_dataset_title":"PLATFORM_messages_multidelete_dataset_title";return this.translateTemplate(e,{appControllerName:this.props.controllerDisplayName},this.getEditorAPI())},render:i})}),define("platform/panels/warnForDisconnectedComponentsPanel.rt",["react","lodash","panels","baseUI"],function(e,t,n,o){"use strict";return function(){return e.createElement(n.frames.confirmationPanelFrame,{type:"important",panelName:"platform.panels.warnForDisconnectedComponentsPanel",onCancel:this.props.undo,confirmLabel:"PLATFORM_messages_continue",cancelLabel:"PLATFORM_messages_cancel",shouldCloseByDefaultOnConfirm:!0,panelTitle:this.getTitle()},e.createElement("div",{className:"icon"},e.createElement(o.symbol,{name:"platformWarning"})),this.props.connectedComps?e.createElement("div",{className:"content",key:"connectedCompsContent"},e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_element_text_line1")),e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_element_text_line2"))):null,this.props.connectedComps?null:e.createElement("div",{className:"content",key:"connectedDatasetContent"},e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_dataset_text_line1")),e.createElement("p",{},this.translateIfNeeded("PLATFORM_messages_move_connected_dataset_text_line2"))))}}),define("platform/panels/warnForDisconnectedComponentsPanel",["create-react-class","prop-types","lodash","util","platform/panels/warnForDisconnectedComponentsPanel.rt"],function(e,t,n,o,i){"use strict";return e({displayName:"warnForDisconnectedComponentsPanel",propTypes:{undo:t.func.isRequired,connectedComps:t.bool.isRequired},mixins:[o.translationMixin],getTitle:function(){var e=this.props.connectedComps?"PLATFORM_messages_move_connected_element_title":"PLATFORM_messages_move_connected_dataset_title";return this.translateIfNeeded(e)},render:i})}),define("platform/panels/appBuilderUpdateTypePanel.rt",["react","lodash","panels","baseUILib","util"],function(e,t,n,o,i){"use strict";return function(){return e.createElement(n.frames.focusPanelFrame,{shouldHideHeader:!0,panelName:"platform.panels.appBuilderUpdateTypePanel"},e.createElement(o.Composites.PopupMediumSize,{},e.createElement(o.Composites.BigPanelHeader,{},e.createElement(o.PanelHeaderCenteredText,{title:"AppStudio_Publish_UpdateType_Title",subtitle:"AppStudio_Publish_UpdateType_Subtitle",titleType:"T16",shouldTranslate:!0,onHelp:this.openUpdateHelpCenter,onClose:this.onCancel,className:"dark"})),e.createElement(o.Composites.PanelContent,{className:"update-panel-content"},e.createElement(o.Composites.RadioButtonsWithIllustration,{},e.createElement(o.RadioButtonsWithIllustration,{value:this.state.updateType,onChange:this.onRadioButtonClick,options:this.getTitleAndTextOptions()}))),e.createElement(o.Composites.ActionSetHorizontalSpaced,{},e.createElement(o.Button,{className:"btn-text",onClick:this.openUpdateHelpCenter},i.translate("AppStudio_LeftTree_Components_Update_Help_Link")),e.createElement(o.Button,{onClick:this.onUpdate},e.createElement("span",{},i.translate("AppStudio_Update_Button"))))))}}),define("platform/panels/appBuilderUpdateTypePanel",["lodash","create-react-class","prop-types","util","stateManagement","constants","platform/panels/appBuilderUpdateTypePanel.rt"],function(e,t,n,o,i,a,r){"use strict";var p=i.panels.actions,s=a.APP_STUDIO.BUILD_VERSION_TYPES,l=s.MINOR,c=s.MAJOR,d=t({displayName:"appBuilderUpdateTypePanel",propTypes:{onClose:n.func,onUpdate:n.func},mixins:[o.translationMixin],getInitialState:function(){return{updateType:e.toUpper(l)}},onUpdate:function(){this.props.onClose(),this.props.onUpdate(this.state.updateType)},onCancel:function(){this.props.onClose(),this.props.onCancel()},openUpdateHelpCenter:function(){this.props.openHelpCenter("be742601-7900-4fa3-9825-c74972eab4aa",null)},onRadioButtonClick:function(e){this.setState({updateType:e})},getTitleAndTextOptions:function(){return[{value:e.toUpper(l),title:"AppStudio_Publish_UpdateType_Type1_Heading",text:"AppStudio_Publish_UpdateType_Type1_Text",shouldTranslate:!0},{value:e.toUpper(c),title:"AppStudio_Publish_UpdateType_Type2_Heading",text:"AppStudio_Publish_UpdateType_Type2_Text",shouldTranslate:!0}]},render:r});return o.hoc.connect(o.hoc.STORES.STATE_AND_DS,e.noop,function(n,e){var t=e.panelName;return{onClose:function(){return n(p.closePanelByName(t))},openHelpCenter:function(e,t){return n(i.editorPlugins.panels.actions.openHelpCenter(e,t))}}})(d)}),define("platform/platformNotification/platformNotification.rt",["react","lodash","notifications","baseUILib"],function(e,t,n,o){"use strict";return function(){return e.createElement(n.notificationFrame,{type:this.props.type,close:this.close},e.createElement("div",{className:"platform-notification-content"},this.props.title?e.createElement(o.RichText,{key:"notification-title",type:"T07",className:"notification-title"},this.props.title):null,e.createElement(o.RichText,{},e.createElement("p",{className:"notification-message"},this.props.message)),e.createElement(o.RichText,{},this.props.linkAction&&this.props.linkAction.caption?e.createElement("a",{className:"notification-link",onClick:this.onLinkClicked,key:"notification-link-action"},this.props.linkAction.caption):null)))}}),define("platform/platformNotification/platformNotification",["lodash","create-react-class","prop-types","constants","platform/platformNotification/platformNotification.rt"],function(e,t,n,o,i){"use strict";return t({displayName:"platformNotification",propTypes:{name:n.string,type:n.oneOf(e.values(o.NOTIFICATIONS.TYPES)).isRequired,title:n.string,message:n.string.isRequired,linkAction:n.shape({caption:n.string.isRequired,onClick:n.func.isRequired}),close:n.func.isRequired,onClose:n.func.isRequired},close:function(){this.props.onClose(),this.props.close()},onLinkClicked:function(){this.props.linkAction.onClick(),this.props.close()},render:i})}),define("platform/plugins/notifyApplicationAfterComponentPasted",["lodash","platformEvents","stateManagement"],function(a,r,p){"use strict";return function(o,e){var i=function(e){var t=o.components.data.get(e).applicationId;return o.platform.getAppDataByAppDefId(t).applicationId};a.forEach(e,function(n){if(p.editorPlugins.components.selectors.isAppWidget(n,o.dsRead)){var e=i(n);o.platform.notifyApplication(e,r.factory.widgetPasted({componentRef:n}))}else{var t=o.platform.controllers.connections.get(n);a.forEach(t,function(e){var t=i(e.controllerRef);o.platform.notifyApplication(t,r.factory.connectedComponentPasted({componentRef:n,connection:e}))})}})}}),define("platform/plugins/platformCompNamePlugin",[],function(){"use strict";return{create:function(a){var r=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).considerControllerTypeDisplayName;return function(e){var t=a.dsRead.platform.controllers.getStageData(e);if(t){if(t.displayName)return t.displayName;if(r&&t.controllerTypeDisplayName)return t.controllerTypeDisplayName}var n=a.dsRead.components.data.get(e).applicationId;if(n===a.dsRead.platform.editorApps.DATA_BINDING.appDefId)return"";var o=a.dsRead.platform.getAppDataByAppDefId(n);if(o){var i=a.dsRead.tpa.appMarket.getData(n);return i&&i.name?i.name:o.appDefinitionName||""}return""}}}}),define("platform/addPanel/sectionTypesMap",["addPanelDataConsts"],function(e){"use strict";return{LIST:e.SECTIONS_TYPES.GENERIC_LIST_SECTION}}),define("platform/addPanel/imagesMap",[],function(){"use strict";return{LOGO0:"platform/widgetSection/widget-color-1.png",LOGO1:"platform/widgetSection/widget-color-2.png",LOGO2:"platform/widgetSection/widget-color-3.png",LOGO3:"platform/widgetSection/widget-color-4.png",LOGO4:"platform/widgetSection/widget-color-5.png",ROBOT:"platform/widgetSection/add-panel-robot.png"}}),define("platform/addPanel/categoryDefinitionValidator",["lodash","platform/addPanel/sectionTypesMap"],function(a,r){"use strict";var p=function(e){return a.isString(e)&&!a.isEmpty(e)};return{validate:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.title,o=t.header,i=t.type;return p(n)&&p(o)&&(e=i,a.has(r,e))}}}),define("platform/addPanel/sectionDefinitionValidator",["lodash","platform/addPanel/imagesMap"],function(p,s){"use strict";var l=["IMAGE_LIST"];return{validate:function(){var e,t,n,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=o.title,a=o.image,r=o.imageSource;return n=i,p.isString(n)&&!p.isEmpty(n)&&(t=r,!(e=a)||p.includes(l,t)&&p.has(s,e))}}}),define("platform/addPanel/sectionsGenerator",["lodash","stateManagement","coreUtilsLib","platform/addPanel/sectionTypesMap","platform/addPanel/imagesMap","platform/addPanel/categoryDefinitionValidator","platform/addPanel/sectionDefinitionValidator","coreBi"],function(l,e,n,c,s,o,d,u){"use strict";var a=e.platform.selectors,f=e.platform.actions,r=function(e,n){return l.defaultsDeep({props:{items:l.map(e.props.items,function(e){return l.defaults({},e,{image:(t=n,s["LOGO"+t%5])});var t})}},e)},m=function(e,t,n){var o=n.title,i=n.desc,a=n.image,r=n.id,p=n.appExtraData;return{id:r,title:o,desc:i,shouldTranslate:!1,showSectionHeader:!0,symbol:"plusBig",tooltip:"add_section_add_page_blankpage_tooltip",image:s[a],onItemClick:function(){e.panelManager.closeAllPanels(),e.store.dispatch(f.notifyAddWidget(t.applicationId,r,p)),e.bi.event(u.events.platform.add_widget_to_page,{source_name:"add_panel",widget_id:r,app_id:t.appDefinitionId})}}},p=function(e,t,n){var o,i,a,r,p=n.app,s=n.categoryDefinition;return{hide:!1,id:p.appDefinitionId,type:c[s.type],title:s.title,subNavigationTitle:s.title,presetTitle:s.header,subNavigationHide:t,showSectionHeader:!0,shouldTranslate:!1,help:{hide:!0},props:{items:(o=e,i=p,a=s,r=a.items,l(r).partition(d.validate).thru(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];return g(o,"section"),n}).map(l.partial(m,o,i)).value())}}},g=function(e,t){return l.forEach(e,function(e){return n.log.error("Invalid "+t+" definition: "+JSON.stringify(e))})};return{createSections:function(t){var e=t.dsRead.platform.getInstalledEditorApps(),i=void 0;return l(e).map(function(e){return{app:e,categoryDefinition:a.getAddPanelCategoryDefinitionFromManifest(t.dsRead,e.appDefinitionId)}}).filter("categoryDefinition").partition(function(e){var t=e.categoryDefinition;return o.validate(t)}).thru(function(e){var t=_slicedToArray(e,2),n=t[0],o=t[1];return g(o,"category"),i=!(5<=n.length),n}).map(function(e){return p(t,i,e)}).sortBy("title").map(r).value()}}}),define("platform/addPanel/platformAddPanel",["addPanelDataConsts","platform/addPanel/sectionsGenerator"],function(t,n){"use strict";return{register:function(){require(["addPanelInfra"],function(e){e.addPanelData.manager.override.sections.register(t.CATEGORIES_ID.INSTALLED_APPS,n.createSections)})}}}),define("platform",["lodash","platformEvents","experiment","util","coreBi","platform/appController/appController","platform/connection/connection","platform/api/api","platform/services/platformPostMessageService","platform/services/platformWorkerService","platform/services/platformConnectedGfpp","platform/services/flowPlatformApps","platform/services/tokenService","platform/common/constants","platform/common/utils","platform/plugins/componentsRemoveHandlerPlugins","platform/panels/appControllerDeleteConfirmationPanel","platform/panels/warnForDisconnectedComponentsPanel","platform/panels/appBuilderUpdateTypePanel","platform/platformNotification/platformNotification","platform/plugins/notifyApplicationAfterComponentPasted","platform/plugins/platformCompNamePlugin","platform/utils/upgradeUtils","platform/addPanel/platformAddPanel","stateManagement"],function(p,n,s,l,c,d,u,f,m,g,e,P,t,o,A,v,i,a,r,I,T,_,h,C,y){"use strict";function E(t){var e=t.platform.getInstalledEditorApps();p.forEach(e,function(e){t.dsActions.platform.notifyApplication(e.applicationId,n.factory.siteWasPublished())})}return{api:f,init:function(e,t,n,o){var i=function t(e,n){return p.isFunction(e)?p.partial(e,n):p.isObject(e)?p.mapValues(e,function(e){return t(e,n)}):e}(f,e),a=e.dsRead.platform.getAPIForSDK(i);d.init(e,n),u.init(t),m.init(e,a);var r=A.getExtraNamespaces();return e.dsActions.platform.init(i,{extraNamespaces:r},o),P.runFlowPlatformApps(e),function(i){i.dsActions.platform.registerToManifestAdded(function(){return i.store.dispatch(y.editorPlugins.services.actions.onViewerChanged())}),i.dsActions.platform.registerToManifestAdded(function(e,t){return function(e){var t="manifest set for app "+e;l.performance.mark(t);var n="time for manifest app "+e;l.performance.measure(n,"editor ready",t);var o=l.performance.getMeasure(n).duration;i.bi.event(c.events.editor.APP_MANIFEST_LOADED,{ts:Math.round(o),app_id:e})}(t.appDefinitionId)}),i.registerSitePublishedCallbacks(p.partial(E,i)),i.registerAfterPasteComponentCallback(T),i.registerComponentsRemoveHandlerPlugin(v.confirmOnOrphanConnections);var e=p.partial(m.onSetAppPublicAPI,i);return i.dsActions.platform.registerToPublicApiSet(e),i.registerCompNamePlugin("platform.components.AppWidget",_.create(i)),i.registerCompNamePlugin("platform.components.AppController",_.create(i,{considerControllerTypeDisplayName:!0})),new Promise(function(t){s.isOpen("se_platform_modal_native_panel")?g.createWorkerMessagesAPI().then(function(e){i.store.dispatch(y.editorPlugins.rendererPanelsWorkerService.actions.setWorkerMessagesAPI(e)),t()}):t()})}(e)},platformPostMessageService:m,platformConnectedGfpp:e,tokenService:t,constants:o,utils:A,upgradeUtils:h,panels:{appControllerDeleteConfirmationPanel:i,warnForDisconnectedComponentsPanel:a,appBuilderUpdateTypePanel:r},platformNotification:I,onAddPanelLoaded:function(e){C.register(e)}}});
//# sourceMappingURL=platform.min.js.map